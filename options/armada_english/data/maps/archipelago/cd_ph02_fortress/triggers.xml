<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
	<trigger Name="GlobalVar" active="1">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			g_ObjCont:SetGameTime( gMissionTime[1], gMissionTime[2], gMissionTime[3], gMissionTime[4], gMissionTime[5] )
			
			SetWeather(0)

			RuleConsole("cinematic_spring_coeff 0.3")

			ShowMap()

			Radar:SetScanRadius(1100)

			Journal:AddPrototypeToEncyclopaedia("triple152CIT01")

			GetPlayerVehicle():setImmortalMode(1)
			GetPlayerVehicle():SetNameFromScript("MyCar")
			SetCameraBehindPlayerVehicle()
			TActivate("PlayerDead")

			local friendly = {}
			local enemy = {}
			--                {objName							Type				Prototype		EffHP VehHP FP Maneuv.		FriendlyName}
			friendly[1] = {"CDHelicopter01_vehicle_0", "CDHelicopterLeaderAegean", "CDPH02_HeliCD01", 13, 250, 627, 140, "call sign “Nomad” (“Mosquito” helicopters flight)"}
			friendly[2] = {"CDHelicopter01_vehicle_1", "CDHelicopterAegean", "CDPH02_HeliCD02", 13, 250, 627, 140, "none"}
			friendly[3] = {"CDHelicopter01_vehicle_2", "CDHelicopterAegean", "CDPH02_HeliCD03", 13, 250, 627, 140, "none"}
			friendly[4] = {"CDHelicopter01_vehicle_3", "CDHelicopterAegean", "CDPH02_HeliCD04", 13, 250, 627, 140, "none"}
			friendly[5] = {"CDHelicopter02_vehicle_0", "CDHelicopterLeaderAegean", "CDPH02_HeliCD02", 13, 250, 627, 140, "call sign “Thunderbolt” (“Mosquito” helicopters flight)"}
			friendly[6] = {"CDHelicopter02_vehicle_1", "CDHelicopterAegean", "CDPH02_HeliCD01", 13, 250, 627, 140, "none"}
			friendly[7] = {"CDHelicopter02_vehicle_2", "CDHelicopterAegean", "CDPH02_HeliCD03", 13, 250, 627, 140, "none"}
			friendly[8] = {"CDHelicopter02_vehicle_3", "CDHelicopterAegean", "CDPH02_HeliCD04", 13, 250, 627, 140, "none"}
			friendly[9] = {"CDHelicopter03_vehicle_0", "CDHelicopterLeaderAegean", "CDPH02_HeliCD03", 13, 250, 627, 140, "call sign “Rogue” (“Mosquito” helicopters flight)"}
			friendly[10] = {"CDHelicopter03_vehicle_1", "CDHelicopterAegean", "CDPH02_HeliCD02", 13, 250, 627, 140, "none"}
			friendly[11] = {"CDHelicopter03_vehicle_2", "CDHelicopterAegean", "CDPH02_HeliCD01", 13, 250, 627, 140, "none"}
			friendly[12] = {"CDHelicopter03_vehicle_3", "CDHelicopterAegean", "CDPH02_HeliCD04", 13, 250, 627, 140, "none"}
			friendly[13] = {"CDHelicopter04_vehicle_0", "CDHelicopterLeaderAegean", "CDPH02_HeliCD04", 13, 250, 627, 140, "call sign “Angel” (“Mosquito” helicopters flight)"}
			friendly[14] = {"CDHelicopter04_vehicle_1", "CDHelicopterAegean", "CDPH02_HeliCD02", 13, 250, 627, 140, "none"}
			friendly[15] = {"CDHelicopter04_vehicle_2", "CDHelicopterAegean", "CDPH02_HeliCD03", 13, 250, 627, 140, "none"}
			friendly[16] = {"CDHelicopter04_vehicle_3", "CDHelicopterAegean", "CDPH02_HeliCD01", 13, 250, 627, 140, "none"}
			--                {objName		EffHP VehHP FP Maneuv.}
			enemy[1] = {"CITBoat01_vehicle_0", 33, 125, 623, 55}
			enemy[2] = {"CITBoat01_vehicle_1", 33, 125, 623, 55}
			enemy[3] = {"CITBoat01_vehicle_2", 33, 125, 623, 55}
			enemy[4] = {"CITDestroyer01_vehicle_0", 1200, 1200, 6802, 26}
			enemy[5] = {"CITDestroyer01_vehicle_1", 1200, 1200, 6802, 26}
			enemy[6] = {"CITTorpedoBoat01_vehicle_0", 39, 300, 954, 80}
			enemy[7] = {"CITTorpedoBoat01_vehicle_1", 39, 300, 954, 80}
			enemy[8] = {"CITOldCruiser01_vehicle_0", 2000, 2000, 8214, 20}
			enemy[9] = {"CITBoat02_vehicle_0", 33, 125, 623, 55}
			enemy[10] = {"CITLav01_vehicle_0", 20, 300, 694, 0}
			enemy[11] = {"CITLav01_vehicle_1", 20, 300, 694, 0}
			enemy[12] = {"CITLav02_vehicle_0", 20, 300, 694, 0}
			enemy[13] = {"CITLav03_vehicle_0", 20, 300, 694, 0}
			enemy[14] = {"CITLav03_vehicle_1", 20, 300, 694, 0}
			enemy[15] = {"CITHelicopter01_vehicle_0", 20, 500, 1514, 110}
			enemy[16] = {"CITHelicopter01_vehicle_1", 20, 500, 1514, 110}
			enemy[17] = {"CITHelicopter02_vehicle_0", 20, 500, 1514, 110}
			enemy[18] = {"CITHelicopter02_vehicle_1", 20, 500, 1514, 110}
			enemy[19] = {"CITHelicopter03_vehicle_0", 20, 500, 1514, 110}
			enemy[20] = {"CITHelicopter03_vehicle_1", 20, 500, 1514, 110}
			enemy[21] = {"CITHelicopter04_vehicle_0", 20, 500, 1514, 110}
			enemy[22] = {"CITHelicopter04_vehicle_1", 20, 500, 1514, 110}
			enemy[23] = {"CITHelicopter05_vehicle_0", 20, 500, 1514, 110}
			enemy[24] = {"CITHelicopter05_vehicle_1", 20, 500, 1514, 110}
			enemy[25] = {"CITHelicopter06_vehicle_0", 20, 500, 1514, 110}
			enemy[26] = {"CITHelicopter06_vehicle_1", 20, 500, 1514, 110}
			enemy[27] = {"CITHelicopter07_vehicle_0", 20, 500, 1514, 110}
			enemy[28] = {"CITHelicopter07_vehicle_1", 20, 500, 1514, 110}
			enemy[29] = {"CITHelicopter08_vehicle_0", 20, 500, 1514, 110}
			enemy[30] = {"CITHelicopter08_vehicle_1", 20, 500, 1514, 110}
			enemy[31] = {"CITCoastalGun01", 195, 17500, 3089, 0}
			enemy[32] = {"CITCoastalGun03", 195, 17500, 3089, 0}
			enemy[33] = {"CITCoastalGun05", 195, 17500, 3089, 0}
			enemy[34] = {"CITCoastalGun06", 195, 17500, 3089, 0}
			enemy[35] = {"CITAAGun01", 65, 3000, 629, 0}
			enemy[36] = {"CITAAGun02", 65, 3000, 629, 0}
			enemy[37] = {"CITAAGun05", 65, 3000, 629, 0}
			enemy[38] = {"CITAAGun06", 65, 3000, 629, 0}
			enemy[39] = {"CITAAGun08", 65, 3000, 629, 0}
			enemy[40] = {"CITAAGun09", 65, 3000, 629, 0}
			enemy[41] = {"CITAAGun11", 65, 3000, 629, 0}
			enemy[42] = {"CITAAGun12", 65, 3000, 629, 0}
			if HardMode~=nil then
				enemy[43] = {"CITCoastalGun02", 195, 17500, 3089, 0}
				enemy[44] = {"CITCoastalGun04", 195, 17500, 3089, 0}
				enemy[45] = {"CITAAGun03", 65, 3000, 629, 0}
				enemy[46] = {"CITAAGun04", 65, 3000, 629, 0}
				enemy[47] = {"CITAAGun07", 65, 3000, 629, 0}
				enemy[48] = {"CITAAGun10", 65, 3000, 629, 0}
			end
			
			SetVar("MissionTime", 0)
			SetVar("RequiredMissionTime", 360) -- mission completion time (in s) for getting bonus score
			SetVar("BaseRetreatScore", 50) -- base retreat score that may get multiplied depending on 4 different factors
			SetVar("RequiredRetreatScore", 50) -- retreat score that needs to be reached for each friendly unit to successfully retreat
			SetVar("PlayerHealth", 4000)
			SetVar("PlayerVehicleHealth", 4000)
			SetVar("PlayerEndHealth", GetVar("PlayerHealth").AsInt)
			SetVar("PlayerName", "“Cataluna” (“Furia”-class)")
			SetVar("Objectives", 2) -- amount of main objectives, excluding destruction of all enemy units and completing the mission without losses
			SetVar("ObjectiveScoreReward", 30000) -- how much score each objective gives
			SetVar("MissionScoreRewardMultiplier", 0.185) -- multiplier that determines how much money the player will receive for each score point

			local j = 1
			local friendlies = {}
			while friendly[j] do
				friendlies[j] = friendly[j][1]
				j = j + 1
			end
			friendlies = TableToString(friendlies)
			j = 1
			local friendliesTypes = {}
			while friendly[j] do
				friendliesTypes[j] = friendly[j][2]
				j = j + 1
			end
			friendliesTypes = TableToString(friendliesTypes)
			j = 1
			local friendliesPrototypes = {}
			while friendly[j] do
				friendliesPrototypes[j] = friendly[j][3]
				j = j + 1
			end
			friendliesPrototypes = TableToString(friendliesPrototypes)
			j = 1
			local friendliesHealth = {}
			while friendly[j] do
				friendliesHealth[j] = friendly[j][4]
				j = j + 1
			end
			friendliesHealth = TableToString(friendliesHealth)
			j = 1
			local friendliesVehicleHealth = {}
			while friendly[j] do
				friendliesVehicleHealth[j] = friendly[j][5]
				j = j + 1
			end
			friendliesVehicleHealth = TableToString(friendliesVehicleHealth)
			j = 1
			local friendliesFirepower = {}
			while friendly[j] do
				friendliesFirepower[j] = friendly[j][6]
				j = j + 1
			end
			friendliesFirepower = TableToString(friendliesFirepower)
			j = 1
			local friendliesManeuverability = {}
			while friendly[j] do
				friendliesManeuverability[j] = friendly[j][7]
				j = j + 1
			end
			friendliesManeuverability = TableToString(friendliesManeuverability)
			j = 1
			local friendliesNames = {}
			while friendly[j] do
				friendliesNames[j] = friendly[j][8]
				j = j + 1
			end
			friendliesNames = TableToString(friendliesNames)

			j = 1
			local enemies = {}
			while enemy[j] do
				enemies[j] = enemy[j][1]
				j = j + 1
			end
			enemies = TableToString(enemies)
			j = 1
			local enemiesHealth = {}
			while enemy[j] do
				enemiesHealth[j] = enemy[j][2]
				j = j + 1
			end
			enemiesHealth = TableToString(enemiesHealth)
			j = 1
			local enemiesVehicleHealth = {}
			while enemy[j] do
				enemiesVehicleHealth[j] = enemy[j][3]
				j = j + 1
			end
			enemiesVehicleHealth = TableToString(enemiesVehicleHealth)
			j = 1
			local enemiesFirepower = {}
			while enemy[j] do
				enemiesFirepower[j] = enemy[j][4]
				j = j + 1
			end
			enemiesFirepower = TableToString(enemiesFirepower)
			j = 1
			local enemiesManeuverability = {}
			while enemy[j] do
				enemiesManeuverability[j] = enemy[j][5]
				j = j + 1
			end
			enemiesManeuverability = TableToString(enemiesManeuverability)
			SetVar("TotalMissionScore", 0) -- total score gained, gets updated after mission stats calculation with the info about destroyed enemy units; score for enemy units is decided by their firepower
			SetVar("ObjectivesCompleted", 0)
			SetVar("Friendlies", friendlies)
			SetVar("FriendliesTypes", friendliesTypes)
			SetVar("FriendliesPrototypes", friendliesPrototypes)
			SetVar("FriendliesHealth", friendliesHealth) -- friendlies effective hp
			SetVar("FriendliesVehicleHealth", friendliesVehicleHealth) -- friendlies real hp according to the vehicle stats, used in UpdateUnitsStats
			SetVar("FriendliesEndHealth", friendliesHealth) -- friendlies hp at the end of the mission, are updated by UpdateUnitsStats
			SetVar("FriendliesFirepower", friendliesFirepower)
			SetVar("FriendliesManeuverability", friendliesManeuverability)
			SetVar("FriendliesNames", friendliesNames)
			SetVar("Enemies", enemies)
			SetVar("EnemiesHealth", enemiesHealth) -- enemies effective hp
			SetVar("EnemiesVehicleHealth", enemiesVehicleHealth) -- enemies real hp according to the vehicle stats, used in UpdateUnitsStats
			SetVar("EnemiesEndHealth", enemiesHealth) -- enemies hp at the end of the mission, are updated by UpdateUnitsStats
			SetVar("EnemiesFirepower", enemiesFirepower)
			SetVar("EnemiesManeuverability", enemiesManeuverability)
			
			if not getObj("ThePendulum") then
				CreateVehicleEx("PendulumVehicle01", "ThePendulum", CVector(30, 255, 80), 1486)
				local Maschine = getObj("ThePendulum")
				if Maschine then
					Maschine:setGodMode(1)
					Maschine:setImmortalMode(1)
					Maschine:SetExternalPathByName("PendulumPath")
					
					TActivate("trPendulum")
				end
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trPendulum" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local Maschine = GetEntityByName("ThePendulum")
			if Maschine then
				Maschine:SetLinearVelocity(CVector(0, 0, 0))
				Maschine:SetExternalPathByName("PendulumPath")
				local PendulumStat = GetVar("PendulumStatus").AsInt
				local MissionTime = GetVar("MissionTime").AsInt
				if 50>PendulumStat then
					PendulumStat = PendulumStat + 1
					SetVar("PendulumStatus", PendulumStat)
					println("pendstat set to "..PendulumStat)
					MissionTime = MissionTime + 8
					SetVar("MissionTime", MissionTime)
				else
					SetVar("PendulumStatus", 0)
					println("corovan management activated, pendstat set to 0")
					MissionTime = MissionTime + 8
					SetVar("MissionTime", MissionTime)
				end
			end
		
		</script>
	</trigger>

	<trigger Name="trMusicManager" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<script>
			PlayMusic(GetVar("CustomMusicName").AsString)

		</script>
	</trigger>

	<trigger Name="MissionMusicStart" active="1">
		<event timeout="0.5" eventid="GE_TIME_PERIOD" />
		<script>
			PlayMusic("bs_attrition_quiet")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RetreatStart" active="1">
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="MissionStartLoc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat01Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat02Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat03Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat04Loc" />
		<script>
			TActivate("Retreat")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Retreat" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="MissionStartLoc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat03Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat04Loc" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)

			UpdateUnitsStats()

			local b = SpawnMessageBox( "1000" )
			if b == 1 then
				trigger:Deactivate()

				if not(IsQuestTaken("CD_PH02_Retreat")) then
					FailQuest("CD_PH02")
				else
					CompleteQuest("CD_PH02_Retreat")
				end

				UpdateUnitsStats()

				CalcMissionStats()

				PassToMap("hq", "Headquarters_enter", 90, false )
			else
				trigger:Deactivate()

				TActivate("RetreatStart")
			end
			
		</script>
	</trigger>

	<trigger Name="Leave" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave03Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave04Loc" />
		<script>
			if not(IsQuestTaken("CD_PH02_Retreat")) then
				FailQuest("CD_PH02")
			else
				CompleteQuest("CD_PH02_Retreat")
			end

			UpdateUnitsStats()

			CalcMissionStats()

			PassToMap("hq", "Headquarters_enter", 90, false)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="WarningStart" active="0">
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning01Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning02Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning03Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning04Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning05Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning06Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning07Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning08Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning09Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning10Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning11Loc" />
		<script>
			TActivate("Warning")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Warning" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning03Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning04Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning05Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning06Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning07Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning08Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning09Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning10Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning11Loc" />
		<script>
			local b = SpawnMessageBox( "1002" )

			TActivate("WarningStart")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Desertion" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion03Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion04Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion05Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion06Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion07Loc" />
		<script>
			if not(IsQuestTaken("CD_PH02_Retreat")) then
				FailQuest("CD_PH02")
			else
				FailQuest("CD_PH02_Retreat") -- the trigger is identical to Leave, besides this
			end

			UpdateUnitsStats(1) -- the trigger is identical to Leave, besides this

			CalcMissionStats(1) -- the trigger is identical to Leave, besides this

			PassToMap("hq", "Headquarters_enter", 90, false)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MissionStart" active="1">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			local Units
			local Unit
			local coords
			local rots
			-- ================
			--  Main CD Force
			-- ================
			TeamCreate("CDHelicopter01", 1056, CVector(4234, 279, 325), {"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4)})
			TeamCreate("CDHelicopter02", 1056, CVector(4152, 279, 157), {"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4)})
			TeamCreate("CDHelicopter03", 1056, CVector(4431, 279, 194), {"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4)})
			TeamCreate("CDHelicopter04", 1056, CVector(4314, 279, 63), {"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4),"CDPH02_HeliCD0"..math.random(4)})

			-- ----------------
			-- Units parameters

			Units = getObj("CDHelicopter01")
			if Units then
				Units:SetProperty ("TeamTacticPrototype", "BoxTactic")
				Units:_AdjustBehaviour ()
			end

			Units = getObj("CDHelicopter02")
			if Units then
				Units:SetProperty ("TeamTacticPrototype", "BoxTactic")
				Units:_AdjustBehaviour ()
			end

			Units = getObj("CDHelicopter03")
			if Units then
				Units:SetProperty ("TeamTacticPrototype", "BoxTactic")
				Units:_AdjustBehaviour ()
			end

			Units = getObj("CDHelicopter04")
			if Units then
				Units:SetProperty ("TeamTacticPrototype", "BoxTactic")
				Units:_AdjustBehaviour ()
			end

			-- ---------------
			-- Unit parameters

			coords = {{CVector(4234, 279, 325), CVector(4272, 279, 329), CVector(4319, 279, 319), CVector(4346, 279, 339)},
					  {CVector(4152, 279, 157), CVector(4189, 279, 160), CVector(4236, 279, 150), CVector(4264, 279, 170)},
					  {CVector(4431, 279, 194), CVector(4468, 279, 198), CVector(4515, 279, 188), CVector(4542, 279, 208)},
					  {CVector(4314, 279, 63), CVector(4352, 279, 66), CVector(4399, 279, 56), CVector(4426, 279, 76)}}
			for i=1, 4 do
				for j=0, 3 do
					Unit = getObj("CDHelicopter0"..i.."_vehicle_"..j)
					if Unit then
						Unit:SetGamePositionOnGround(coords[i][j+1])
						Unit:SetRotation(Quaternion(0.0000, -0.1305, 0.0000, 0.9914))
					end
				end
			end

			-- ===============
			--  Main CIT Force
			-- ===============
			TeamCreate("CITBoat01", 1002, CVector(3173, 279, 5893), {"CDPH02_SmlboatCIT01","CDPH02_SmlboatCIT01","CDPH02_SmlboatCIT01"})
			TeamCreate("CITDestroyer01", 1003, CVector(3201, 279, 5427), {"CDPH02_DestroyerCIT01", "CDPH02_DestroyerCIT01"})
			TeamCreate("CITTorpedoBoat01", 1002, CVector(3126, 279, 5465), {"CDPH02_FastboatCIT01","CDPH02_FastboatCIT01"})
			TeamCreate("CITOldCruiser01", 1004, CVector(2855, 279, 6114), {"CDPH02_OCruiserCIT01"})
			TeamCreate("CITBoat02", 1002, CVector(2782, 279, 6024), {"CDPH02_SmlboatCIT01"})
			TeamCreate("CITLav01", 1009, CVector(3015, 282, 5837), {"CDPH02_LavCIT01", "CDPH02_LavCIT01"})
			TeamCreate("CITLav02", 1009, CVector(3013, 282, 5855), {"CDPH02_LavCIT01"})
			TeamCreate("CITLav03", 1009, CVector(3016, 282, 5846), {"CDPH02_LavCIT01", "CDPH02_LavCIT01"})
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_01", -1, -1, CVector(2923.513, 278.181, 5622.407), Quaternion(0.0000, 0.5825, 0.0000, 0.8128), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_02", -1, -1, CVector(2980.772, 275.734, 5707.863), Quaternion(0.0000, 0.3624, 0.0000, 0.9320), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_03", -1, -1, CVector(3003.671, 271.374, 5704.236), Quaternion(0.0000, 0.3214, 0.0000, 0.9469), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_04", -1, -1, CVector(3012.763, 271.379, 5723.494), Quaternion(0.0000, 0.1262, 0.0000, 0.9920), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_05", -1, -1, CVector(3014.469, 275.649, 5791.597), Quaternion(0.0000, 0.3624, 0.0000, 0.9320), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_06", -1, -1, CVector(2962.072, 286.657, 5791.947), Quaternion(0.0000, 0.5825, 0.0000, 0.8128), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_07", -1, -1, CVector(3055.040, 267.715, 5938.978), Quaternion(0.0000, 0.0980, 0.0000, 0.9952), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_08", -1, -1, CVector(3063.994, 267.715, 5982.979), Quaternion(0.0000, 0.0980, 0.0000, 0.9952), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_09", -1, -1, CVector(3025.499, 271.322, 5947.065), Quaternion(0.0000, 0.0980, 0.0000, 0.9952), 1 )
			CreateNewDummyObject( "quay_big_cube",	"milos_fortress_10", -1, -1, CVector(3036.453, 271.322, 5986.108), Quaternion(0.0000, 0.0980, 0.0000, 0.9952), 1 )
			CreateNewDummyObject( "berth",	"milos_fortress_11", -1, -1, CVector(3087.252, 273.263, 5955.041), Quaternion(0.0000, -0.6428, 0.0000, 0.7660), 1 )
			CreateNewDummyObject( "berth",	"milos_fortress_12", -1, -1, CVector(3132.177, 273.641, 5946.558), Quaternion(0.0000, 0.7660, 0.0000, 0.6428), 1 )
			CreateNewBreakableObject("CITCoastMed01", "CITCoastalGun01", 1008, CVector(2920.084, 280.000, 5615.984), Quaternion(0.0000, 0.9870, 0.0000, 0.1607), 0)
			CreateNewBreakableObject("CITCoastMed01", "CITCoastalGun03", 1008, CVector(3023.257, 280.000, 5791.831), Quaternion(0.0000, 0.7071, 0.0000, 0.7071), 0)
			CreateNewBreakableObject("CITCoastMed01", "CITCoastalGun05", 1008, CVector(3032.168, 280.000, 5953.336), Quaternion(0.0000, 0.7716, 0.0000, 0.6361), 0)
			CreateNewBreakableObject("CITCoastMed01", "CITCoastalGun06", 1008, CVector(3036.185, 280.000, 5985.753), Quaternion(0.0000, 0.7716, 0.0000, 0.6361), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun01", 1008, CVector(2928.308, 280.000, 5616.266), Quaternion(0.0000, 0.9859, 0.0000, 0.1672), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun02", 1008, CVector(2981.756, 280.000, 5693.411), Quaternion(0.0000, 0.9026, 0.0000, 0.4305), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun05", 1008, CVector(3024.061, 280.000, 5721.797), Quaternion(0.0000, 0.1370, 0.0000, 0.9906), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun06", 1008, CVector(2973.933, 280.000, 5785.728), Quaternion(0.0000, 0.9893, 0.0000, 0.1457), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun08", 1008, CVector(3056.602, 280.000, 5943.719), Quaternion(0.0000, 0.7688, 0.0000, 0.6394), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun09", 1008, CVector(3065.868, 280.000, 5975.215), Quaternion(0.0000, 0.7688, 0.0000, 0.6394), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun11", 1008, CVector(3031.785, 280.000, 5938.713), Quaternion(0.0000, 0.7688, 0.0000, 0.6394), 0)
			CreateNewBreakableObject("CoastAAMed01", "CITAAGun12", 1008, CVector(3043.649, 280.000, 5995.054), Quaternion(0.0000, 0.7688, 0.0000, 0.6394), 0)
			if HardMode~=nil then
				CreateNewBreakableObject("CITCoastMed01", "CITCoastalGun02", 1008, CVector(3013.831, 280.000, 5710.072), Quaternion(0.0000, 0.8900, 0.0000, 0.4559), 0)
				CreateNewBreakableObject("CITCoastMed01", "CITCoastalGun04", 1008, CVector(2964.947, 280.000, 5799.726), Quaternion(0.0000, 0.2334, 0.0000, 0.9724), 0)
				CreateNewBreakableObject("CoastAAMed01", "CITAAGun03", 1008, CVector(2992.333, 280.000, 5705.468), Quaternion(0.0000, 0.9026, 0.0000, 0.4305), 0)
				CreateNewBreakableObject("CoastAAMed01", "CITAAGun04", 1008, CVector(3006.830, 280.000, 5696.030), Quaternion(0.0000, 0.9026, 0.0000, 0.4305), 0)
				CreateNewBreakableObject("CoastAAMed01", "CITAAGun07", 1008, CVector(3050.714, 280.000, 5929.966), Quaternion(0.0000, 0.7688, 0.0000, 0.6394), 0)
				CreateNewBreakableObject("CoastAAMed01", "CITAAGun10", 1008, CVector(3073.091, 280.000, 5987.503), Quaternion(0.0000, 0.7688, 0.0000, 0.6394), 0)
			end

			-- =============
			--  CIT Reserves
			-- =============
			TeamCreate("CITHelicopter01", 1006, CVector(7801, 279, 8004), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})
			TeamCreate("CITHelicopter02", 1006, CVector(332, 279, 7945), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})
			TeamCreate("CITHelicopter03", 1006, CVector(7937, 279, 7919), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})
			TeamCreate("CITHelicopter04", 1006, CVector(8103, 279, 7978), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})
			TeamCreate("CITHelicopter05", 1006, CVector(8012, 279, 8053), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})
			TeamCreate("CITHelicopter06", 1006, CVector(248, 279, 7832), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})
			TeamCreate("CITHelicopter07", 1006, CVector(168, 279, 8021), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})
			TeamCreate("CITHelicopter08", 1006, CVector(183, 279, 8103), {"CDPH02_HeliCIT0"..math.random(4), "CDPH02_HeliCIT0"..math.random(4)})

			-- ----------------
			-- Units parameters

			for i=1, 2 do
				Units = getObj("CITBoat0"..i)
				if Units then
					Units:SetProperty ("TeamTacticPrototype", "MeatTeamTactic")
					Units:_AdjustBehaviour ()
				end
			end

			Units = getObj("CITDestroyer01")
			if Units then
				Units:SetProperty ("TeamTacticPrototype", "StandardTactic")
				Units:_AdjustBehaviour ()
			end

			Units = getObj("CITTorpedoBoat01")
			if Units then
				Units:SetProperty ("TeamTacticPrototype", "AssaultBottomTactic")
				Units:_AdjustBehaviour ()
			end

			Units = getObj("CITOldCruiser01")
			if Units then
				Units:SetProperty ("TeamTacticPrototype", "StandardTactic")
				Units:_AdjustBehaviour ()
			end

			for i=1, 3 do
				Units = getObj("CITLav0"..i)
				if Units then
					Units:SetProperty ("TeamTacticPrototype", "CowardTeamTactic")
					Units:_AdjustBehaviour ()
				end
			end

			for i=1, 8 do
				Units = getObj("CITHelicopter0"..i)
				if Units then
					Units:SetProperty ("TeamTacticPrototype", "CautiousTactic")
					Units:_AdjustBehaviour ()
				end
			end

			-- ---------------
			-- Unit parameters

			coords = {CVector(3173, 279, 5893), CVector(3186, 279, 5918), CVector(3193, 279, 5964)}
			rots = {Quaternion(0.0000, 0.8241, 0.0000, 0.5664), Quaternion(0.0000, 0.7618, 0.0000, 0.6478), Quaternion(0.0000, 0.6018, 0.0000, 0.7986)}
			for i=0, 2 do
				Unit = getObj("CITBoat01_vehicle_"..i)
				if Unit then
					Unit:SetGamePositionOnGround(coords[i+1])
					Unit:SetRotation(rots[i+1])
					if i==0 or i==2 then
						Unit:SetMaxSpeed(0)
						Unit:SetMaxTorque(1)
					end
				end
			end

			coords = {CVector(3201, 279, 5427), CVector(3242, 279, 5991)}
			rots = {Quaternion(0.0000, 0.9820, 0.0000, 0.1887), Quaternion(0.0000, 0.7475, 0.0000, 0.6643)}
			for i=0, 1 do
				Unit = getObj("CITDestroyer01_vehicle_"..i)
				if Unit then
					Unit:SetGamePositionOnGround(coords[i+1])
					Unit:SetRotation(rots[i+1])
				end
			end

			coords = {CVector(3126, 279, 5465), CVector(3156, 279, 5599)}
			rots = {Quaternion(0.0000, 0.9890, 0.0000, 0.1478), Quaternion(0.0000, 0.9382, 0.0000, 0.3461)}
			for i=0, 1 do
				Unit = getObj("CITTorpedoBoat01_vehicle_"..i)
				if Unit then
					Unit:SetGamePositionOnGround(coords[i+1])
					Unit:SetRotation(rots[i+1])
				end
			end

			Unit = getObj("CITOldCruiser01_vehicle_0")
			if Unit then
				Unit:SetRotation(Quaternion(0.0000, 0.2588, 0.0000, 0.9659))
			end
			
			Unit = getObj("CITBoat02_vehicle_0")
			if Unit then
				Unit:SetRotation(Quaternion(0.0000, 0.2588, 0.0000, 0.9659))
			end

			coords = {CVector(3015, 282, 5837), CVector(2996, 282, 5863)}
			rots = {Quaternion(0.0000, -0.1327, 0.0000, 0.9912), Quaternion(0.0000, 0.9906, 0.0000, 0.1370)}
			for i=0, 1 do
				Unit = getObj("CITLav01_vehicle_"..i)
				if Unit then
					Unit:SetGamePositionOnGround(coords[i+1])
					Unit:SetRotation(rots[i+1])
					Unit:SetMaxSpeed(0)
					Unit:SetMaxTorque(1)
				end
			end

			Unit = getObj("CITLav02_vehicle_0")
			if Unit then
				Unit:SetRotation(Quaternion(0.0000, 0.6088, 0.0000, 0.7934))
				Unit:SetMaxSpeed(0)
				Unit:SetMaxTorque(1)
			end
			
--			coords = {CVector(2939, 282, 5904), CVector(2942, 282, 5931)}
			coords = {CVector(3016, 282, 5846), CVector(2991, 282, 5851)}
			rots = {Quaternion(0.0000, 0.8693, 0.0000, 0.4943), Quaternion(0.0000, 0.4403, 0.0000, 0.8978)}
			for i=0, 1 do
				Unit = getObj("CITLav03_vehicle_"..i)
				if Unit then
					Unit:SetGamePositionOnGround(coords[i+1])
					Unit:SetRotation(rots[i+1])
					Unit:SetMaxSpeed(0)
					Unit:SetMaxTorque(1)
				end
			end

			coords = {{CVector(7801, 279, 8004), CVector(7801, 279, 8054)},
					  {CVector(332, 279, 7945), CVector(305, 279, 7898)},
					  {CVector(7937, 279, 7919), CVector(7923, 279, 7941)},
					  {CVector(8103, 279, 7978), CVector(8082, 279, 7997)},
					  {CVector(8012, 279, 8053), CVector(8031, 279, 8102)},
					  {CVector(248, 279, 7832), CVector(191, 279, 7853)},
					  {CVector(168, 279, 8021), CVector(140, 279, 7998)},
					  {CVector(183, 279, 8103), CVector(149, 279, 8108)}}
			rots = {{Quaternion(0.0000, -0.8660, 0.0000, 0.5000), Quaternion(0.0000, -0.8660, 0.0000, 0.5000)},
					{Quaternion(0.0000, 0.9171, 0.0000, 0.3987), Quaternion(0.0000, 0.9171, 0.0000, 0.3987)},
					{Quaternion(0.0000, -0.8660, 0.0000, 0.5000), Quaternion(0.0000, -0.8660, 0.0000, 0.5000)},
					{Quaternion(0.0000, -0.8660, 0.0000, 0.5000), Quaternion(0.0000, -0.8660, 0.0000, 0.5000)},
					{Quaternion(0.0000, -0.8660, 0.0000, 0.5000), Quaternion(0.0000, -0.8660, 0.0000, 0.5000)},
					{Quaternion(0.0000, 0.9171, 0.0000, 0.3987), Quaternion(0.0000, 0.9171, 0.0000, 0.3987)},
					{Quaternion(0.0000, 0.9171, 0.0000, 0.3987), Quaternion(0.0000, 0.9171, 0.0000, 0.3987)},
					{Quaternion(0.0000, 0.9171, 0.0000, 0.3987), Quaternion(0.0000, 0.9171, 0.0000, 0.3987)}}
			for i=1, 8 do
				for j=0, 1 do
					Unit = getObj("CITHelicopter0"..i.."_vehicle_"..j)
					if Unit then
						Unit:SetGamePositionOnGround(coords[i][j+1])
						Unit:SetRotation(rots[i][j+1])
					end
				end
			end

			-- =========
			--  Trigger
			-- =========
			local PlfID = GetPlayerVehicleId()
			FlyLinked( "CDPH02_Start1", PlfID, 30, 0, 1, PlfID )
			StartCinematic()

			AddCinematicMessage( 1, 2)
			AddCinematicMessage( 2, 1)
			AddCinematicMessage( 3, 1)

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetRotation(Quaternion(0.0000, -0.2588, 0.0000, 0.9659))
				Plf:SetExternalPathByName("StartPath_Player")
				Plf:LimitMaxSpeed(5)
			end

			TActivate("MissionStart_End")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MissionStart_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:PlaceToEndOfPath("StartPath_Player")
				Plf:AddModifier("fuel", "+ 6271337")
				Plf:AddModifier("fuel", "- 434")
			end

			TakeQuest("CD_PH02")

			TActivate("AutoSave")
			TActivate("CITTurretsDestroyed")
			TActivate("CITLavsDestroyed")
			TActivate("CITReserves")
			TActivate("CITReinforcements")

			SetCameraBehindPlayerVehicle()

			SetVar("MissionTime", 0)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AutoSave" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:setGodMode(1)
			end

			trigger:Deactivate()

			TActivate("AutoReload")

			AutoSave()
			
		</script>
	</trigger>

	<trigger Name="AutoReload" active="0">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>
			local Plf = GetPlayerVehicle()

			if Plf:getGodMode() then
				SpawnMessageBox( "1003" )
				ShowDeathMenu()
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CITTurretsDestroyed" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun01" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun03" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun05" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun06" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun01" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun02" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun05" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun06" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun08" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun09" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun11" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun12" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)
			local TargetEnemies = {Enemies[31],Enemies[32],Enemies[33],Enemies[34],Enemies[35],Enemies[36],Enemies[37],Enemies[38],Enemies[39],Enemies[40],Enemies[41],Enemies[42]}

			if CheckUnits(TargetEnemies, "dead", 12) then
				LOG("CIT TURRETS DESTROYED")

				UpdateUnitsStats()

				CompleteQuest("CD_PH02_DestroyTurrets")

				TakeQuest("CD_PH02_Retreat")

				PlayMusic("bs_attrition_quiet")

				if CheckDistBetweenUnits(GetPlayerVehicle(), Enemies, "least") >= 1150 then
					local b = SpawnMessageBox( "1001" )
					println("mission end 0")
					if b == 1 then
						trigger:Deactivate()

						CompleteQuestIfTaken("CD_PH02_Retreat")

						println("mission end 1")

						UpdateUnitsStats()

						CalcMissionStats()

						println("mission end 3")

						PassToMap("hq", "Headquarters_enter", 90, false )
					end
				end

				trigger:Deactivate()
			else
				UpdateQuestCoordinates("CD_PH02_DestroyTurrets", TargetEnemies)
			end

		</script>
	</trigger>

	<trigger Name="CITLavsDestroyed" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITLav01_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITLav01_vehicle_1" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITLav02_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITLav03_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITLav03_vehicle_1" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)
			local TargetEnemies = {Enemies[10],Enemies[11],Enemies[12],Enemies[13],Enemies[14]}

			if CheckUnits(TargetEnemies, "dead", 5) then
				LOG("CIT LAVS DESTROYED")

				UpdateUnitsStats()

				CompleteQuest("CD_PH02_DestroyLavs")

				-- set up all the waypoints for cd helis
				local Unit
				for i=1, 4 do
					for j=0, 3 do
						Unit = getObj("CDHelicopter0"..i.."_vehicle_"..j)
						if Unit then
							Unit:SetExternalPathByName("CDHelicopter0"..i.."_vehicle_"..j.."_Waypoint1")
							Unit:SetCanBeDistractedFromMoving(true)
							SetVar("CDHelicopter0"..i.."_vehicle_"..j.."WaypointStatus", TableToString({0, 1, 0})) -- waypoints reached, amount of waypoints, amount of cycles with 0 speed
						end
					end
				end

				AddFadingMsgId("fm_aircraft_enroute_ally")

				TActivate("CDHelicoptersFormationManager")
				TActivate("CDHelicopters_Order")

				trigger:Deactivate()
			else
				UpdateQuestCoordinates("CD_PH02_DestroyLavs", TargetEnemies)
			end

		</script>
	</trigger>

	<trigger Name="CITReinforcements" active="0">
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITBoat01_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CITBoat01_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITDestroyer01_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CITDestroyer01_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITDestroyer01_vehicle_1" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CITDestroyer01_vehicle_1" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITTorpedoBoat01_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CITTorpedoBoat01_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITOldCruiser01_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CITOldCruiser01_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun01" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun02" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun05" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun06" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun08" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun09" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun11" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITAAGun12" />
		<script>
			-- setting up waypoints for cit vehicles
			LOG("PLAYER NOTICED")
			local Unit
			local playerPos = GetPlayerVehicle():GetPosition()

			for i=0, 1 do
				Unit = getObj("CITDestroyer01_vehicle_"..i)
				if Unit then
					Unit:SetExternalPathByName("CITDestroyer01_vehicle_"..i.."_Waypoint1")
					Unit:SetCanBeDistractedFromMoving(true)
				end
			end

			Unit = getObj("CITTorpedoBoat01")
			if Unit then
				Unit:StackOpen()
				Unit:SetDestination(playerPos)
				Unit:StackClose()
			end

			-- setting up waypoints for cit helicopters
			for i=1, 2 do
				for j=0, 1 do
					Unit = getObj("CITHelicopter0"..i.."_vehicle_"..j)
					if Unit then
						Unit:SetExternalPathByName("CITHelicopter0"..i.."_vehicle_"..j.."_Waypoint1")
						Unit:SetCanBeDistractedFromMoving(true)
					end
				end
			end

			AddImportantFadingMsgByStrIdFormatted("fm_cd_ph02_fire")
			AddFadingMsgId("fm_reinforcements_inbound_foe")
			AddFadingMsgId("fm_aircraft_enroute_foe")

			PlayMusic("bs_attrition_combat")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CITReserves" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun01" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun03" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun05" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITCoastalGun06" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)

			if CheckUnits(Enemies, "dead", 14) then
				LOG("A LOT OF ENEMIES ARE DESTROYED")

				UpdateUnitsStats()

				-- setting up waypoints for cit helicopters
				for i=3, 8 do
					for j=0, 1 do
						Unit = getObj("CITHelicopter0"..i.."_vehicle_"..j)
						if Unit then
							Unit:SetExternalPathByName("CITHelicopter0"..i.."_vehicle_"..j.."_Waypoint1")
							Unit:SetCanBeDistractedFromMoving(true)
						end
					end
				end

				AddFadingMsgId("fm_reserves_inbound_foe")

				PlayMusic("bs_attrition_combat")

				trigger:Deactivate()
			end

		</script>
	</trigger>

	<trigger Name="CDHelicoptersFormationManager" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<script>
			-- ================ --
			-- Waypoint Manager --
			-- ================ --
			local vehicles = StringToTable(GetVar("Friendlies").AsString)
			local currentVehicleName -- "CDDestroyer01"
			local currentVehicle -- = getObj("CDDestroyer01_vehicle_0")
			local currentVehicleWaypointInfo -- = StringToTable(GetVar("CDD01aWaypointStatus").AsString)
			local speedThreshold = 3 -- the speed at which the vehicle is deemed suspiciously still
			local checksAmount = 0
			local currentWaypoint = 0
			local vehicleTargetsReached = 0 -- the amount of vehicles that reached the targets, if it equals to the amount of entries in the 'vehicles' table - the trigger deactivates
			LOG("1049")
			-- check if the ships are moving
			-- if they haven't moved for 3 cycles = set them on the current waypoint
			for i=1, getn(vehicles) do
				LOG(i.." 1095")
				currentVehicleName = vehicles[i]
				currentVehicle = getObj(currentVehicleName)
				LOG(i.." 1098")
				if CheckUnits(currentVehicleName) then
					LOG(i.." 1100")
					println(currentVehicleName.." exists")
					currentVehicleWaypointInfo = StringToTable(GetVar(currentVehicleName.."WaypointStatus").AsString)
					currentWaypoint = currentVehicleWaypointInfo[1] + 1
					LOG(i.." 1104")
					if 3 > GetSpeed(currentVehicle) then
						LOG(i.." 1106")
						println(currentVehicleName.." speed is too low")
						checksAmount = currentVehicleWaypointInfo[3] + 1 -- the speed of the vehicle is too low, the check has passed one more time
						println("checks amount is "..checksAmount)
						LOG(i.." 1110")
						if checksAmount >= 3 then
							LOG(i.." 1112")
							println("there have been 3 checks for "..currentVehicleName)
--							currentWaypoint = currentVehicleWaypointInfo[1] + 1
							if currentVehicleWaypointInfo[2] > currentWaypoint then
								LOG(i.." 1116")
								currentVehicle:SetExternalPathByName(currentVehicleName.."_Waypoint"..currentWaypoint) -- the vehicle is set on the path for the current waypoint
								currentVehicle:SetCanBeDistractedFromMoving(true) -- set this to false or remove the line if this trigger is used for racing, lol
								println(currentVehicleName.." set for the current waypoint")
								LOG(i.." 1120")
							else
								LOG(i.." 1122")
								println("maximum waypoints for "..currentVehicleName.." reached")
							end
						end
					else
						LOG(i.." 1127")
						println(currentVehicleName.." speed is fine")
						checksAmount = 0 -- the speed of the vehicle is okay, the checks are dropped
					end

					LOG(i.." 1132")
					currentWaypoint = currentWaypoint - 1
					currentVehicleWaypointInfo[1] = currentWaypoint
					currentVehicleWaypointInfo[3] = checksAmount
					SetVar(currentVehicleName.."WaypointStatus", TableToString(currentVehicleWaypointInfo))
					println(currentVehicleName.." waypoint info updated")
					LOG(i.." 1138")
					if currentVehicleWaypointInfo[1] >= currentVehicleWaypointInfo[2] then
						LOG(i.." 1140")
						vehicleTargetsReached = vehicleTargetsReached + 1
					end
				end
			end

			LOG("1150")
			if vehicleTargetsReached==getn(vehicles) then
				LOG("1152")
				println("all vehicles reached their targets")
				LOG("ALL CD HELICOPTERS REACHED THE TARGET")
				trigger:Deactivate()
			end

		</script>
	</trigger>

	<trigger Name="CDHelicopters_Order" active="0">
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_1" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_2" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_3" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_1" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_2" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_3" />
		<script>
			TActivate("CDHelicopters_Target")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CDHelicopters_Target" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_1" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_1" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_2" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_2" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_3" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_3" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_1" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_1" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_2" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_2" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_3" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_3" />
		<script>
			local Unit
			local Target
			local BombingTargets = {}
			local Friendlies = StringToTable(GetVar("Friendlies").AsString)
			local Enemies = StringToTable(GetVar("Enemies").AsString)
			local PossibleEffects = {
				"ET_PS_BIGBLAST_APVEHICLEEXPLOSION",
				"ET_PS_BIGBLAST_HESTATICSEXPLOSION",
				"ET_PS_GNTBLAST_APVEHICLEEXPLOSION",
				"ET_PS_BIGBLAST_HEVEHICLEEXPLOSION",
				"ET_PS_GNTBLAST_HESTATICSEXPLOSION"
				}

			local AliveFriendlies = {}
			local k = 1
			for i=1, 16 do
				if CheckUnits(Friendlies[i]) then
					AliveFriendlies[k] = Friendlies[i]

					k = k + 1
				end
			end

			local TargetEnemies = {}
			k = 1
			for i=31, 42 do
				if CheckUnits(Enemies[i]) then
					TargetEnemies[k] = Enemies[i]

					k = k + 1
				end
			end

			LOG(TableToString(TargetEnemies))

			if getn(AliveFriendlies)~=0 then
				LOG(1104)
				if getn(TargetEnemies)~=0 then
					LOG(1106)
					LOG(1107)
					k = 1
					for i = 1, getn(TargetEnemies) do
						LOG(i.." 1110")
						Unit = TargetEnemies[i]
						LOG(i.." 1112")
						Target = CheckDistBetweenUnits(Unit, AliveFriendlies, "least")
						if 550 >= Target then
							LOG("distance to "..Unit.." is "..Target..", set up for bombing")
--							BombingTargets[k] = getObj(TargetEnemies[i]):GetPosition()
							BombingTargets[k] = TargetEnemies[i]

							k = k + 1
						end
						
						LOG(i.." is "..Unit)
						Unit = getObj(AliveFriendlies[i])
						LOG(i.." 1123")
					end

					-- randomly choose one target, spawn explosion effect near it
					if getn(BombingTargets)~=0 then
						k = math.random(1, getn(BombingTargets))
						LOG("Target 1129")
--						Target = BombingTargets[k]
						Target = getObj(BombingTargets[k])
						if Target then
							k = 3000 + math.random(1, 800)
							Target:AddModifier("hp", "- "..k)
						end

						Target = Target:GetPosition()

						LOG("Target 1143")

						Target.x = Target.x - math.random(15) + math.random(15)
						Target.z = Target.z - math.random(15) + math.random(15)
						CreateEffectTTLed(PossibleEffects[exrandom(getn(PossibleEffects))], Target, Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 10000)

						LOG("Target 1149")
						SetVar("BombingTargets", TableToString(BombingTargets))
					else
						SetVar("BombingTargets", "{}")
					end

					TActivate("CDHelicopters_Shooting") -- this trigger should spawn blastwaves at all targets and several explosion effects
					LOG("Target 1154")
				else
					LOG("ALL TARGETS FOR BOMBING ARE DEAD")
				end
			end

			LOG("Target 1158")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CDHelicopters_Shooting" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_1" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_2" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_3" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_1" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_2" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_3" />
		<script>
			LOG("Shooting 1168")
			local k
			local Target
			LOG("Shooting 1170")
			local BombingTargets = StringToTable(GetVar("BombingTargets").AsString)
			LOG("Shooting 1172")
			local PossibleEffects = {
				"ET_PS_SMLBLAST_HEVEHICLEEXPLOSION",
				"ET_PS_SMLBLAST_APVEHICLEEXPLOSION",
				"ET_PS_MEDBLAST_APVEHICLEEXPLOSION",
				"ET_PS_MEDBLAST_HESTATICSEXPLOSION",
				"ET_PS_MEDBLAST_HEVEHICLEEXPLOSION",
				}
			LOG("Shooting 1180")

			if getn(BombingTargets)~=0 then
				for i=1, getn(BombingTargets) do
					LOG(i.." Shooting 1178")
					if CheckUnits(BombingTargets[i]) then
						Target = getObj(BombingTargets[i])

						k = 1000 + math.random(1, 500)
						Target:AddModifier("hp", "- "..k)

						Target = Target:GetPosition()

						LOG(i.." Shooting 1192")

						Target.x = Target.x - math.random(15) + math.random(15)
						Target.z = Target.z - math.random(15) + math.random(15)
						CreateEffectTTLed(PossibleEffects[exrandom(getn(PossibleEffects))], Target, Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 10000)

						LOG(i.." Shooting 1198")
					end
				end
			end

			TActivate("CDHelicopters_Target")
			LOG("Shooting 1203")

			trigger:Deactivate()
		</script>
	</trigger>
<!--	
	<trigger Name="CDHelicopters_Target" active="0">
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_1" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_1" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_1" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_2" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_2" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_2" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter01_vehicle_3" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter01_vehicle_3" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter01_vehicle_3" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_0" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_1" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_1" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_1" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_2" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_2" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_2" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CDHelicopter02_vehicle_3" />
		<event eventid="GE_UNDER_ATTACK" ObjName="CDHelicopter02_vehicle_3" />
		<event eventid="GE_OBJECT_DIE" ObjName="CDHelicopter02_vehicle_3" />
		<script>
			local Unit
			local Target
			local Friendlies = StringToTable(GetVar("Friendlies").AsString)
			local Enemies = StringToTable(GetVar("Enemies").AsString)

			local AliveFriendlies = {}
			local k = 1
			for i=1, 16 do
				if CheckUnits(Friendlies[i]) then
					AliveFriendlies[k] = Friendlies[i]

					k = k + 1
				end
			end

			local TargetEnemies = {}
			k = 0
			for i=31, 42 do
				if CheckUnits(Enemies[i]) then
					TargetEnemies[k] = Enemies[i]

					k = k + 1
				end
			end

			if getn(AliveFriendlies)~=0 then
				LOG(1083)
				if getn(TargetEnemies)~=0 then
					LOG(1085)
					if CheckUnits(TargetEnemies, "alive", 1) then
						LOG(1087)
						for i = 1, getn(AliveFriendlies) do
							LOG(i.." 1089")
							Unit = AliveFriendlies[i]
							if CheckUnits(Unit) then
								LOG(i.." 1092")
								-- Target Clarification
								-- get closest enemy
								-- put it into var
								-- Target = GetVar("cdhelicopter01_vehicle_0_target").AsString
								Target = CheckDistBetweenUnits(Unit, TargetEnemies, "least", "name")
								SetVar(Unit.."_Target", Target)
								LOG(i.." is "..Unit)
								Unit = getObj(AliveFriendlies[i])
								LOG(i.." 1099")
								LOG(i.." target is "..Target)

--								Unit:SetCustomControlEnabled(1)
--								Unit:SetCustomControlWeapons(2)
--								Unit:SetCustomControlWeaponsTargetObj(GetEntityByName(Target):GetId())
--								Unit:FireFromWeaponCustom2(1, GetEntityByName(Target):GetId())
								Unit:SetCustomControlEnabled(1)
								Unit:SetCustomControlWeapons(1)
								Unit:SetCustomControlWeaponsTarget(getObj(Target):GetPosition())
								Unit:FireFromWeaponCustom(1, getObj(Target):GetPosition())
								LOG(i.." 1105")
							end
						end

						TActivate("CDHelicopters_Shooting")
						LOG("Target 1110")
					end
				end
			end

			LOG("Target 1122")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CDHelicopters_Shooting" active="0">
	<event timeout="0.25" eventid="GE_TIME_PERIOD" />
		<script>	
			LOG("Shooting 1131")
			local Unit
			local Target
			local Friendlies = StringToTable(GetVar("Friendlies").AsString)
			local Enemies = StringToTable(GetVar("Enemies").AsString)

			local AliveFriendlies = {}
			local k = 1
			for i=1, 16 do
				if CheckUnits(Friendlies[i]) then
					AliveFriendlies[k] = Friendlies[i]

					k = k + 1
				end
			end

			local TargetEnemies = {}
			k = 0
			for i=31, 42 do
				if CheckUnits(Enemies[i]) then
					TargetEnemies[k] = Enemies[i]

					k = k + 1
				end
			end
			LOG("Shooting 1156")

			if getn(AliveFriendlies)~=0 then
				if getn(TargetEnemies)~=0 then
					if CheckUnits(TargetEnemies, "alive", 1) then
						for i = 1, getn(AliveFriendlies) do
							Unit = AliveFriendlies[i]
							if CheckUnits(Unit) then
								-- Target Clarification
								-- get closest enemy
								-- put it into var
								-- Target = GetVar("cdhelicopter01_vehicle_0_target").AsString
								Target = GetVar(Unit.."_Target").AsString
								Unit = GetEntityByName(AliveFriendlies[i])

--								Unit:SetCustomControlWeaponsTargetObj(GetEntityByName(Target):GetId())
--								Unit:FireFromWeaponCustom2(1, GetEntityByName(Target):GetId())
								Unit:SetCustomControlWeaponsTarget(getObj(Target):GetPosition())
								Unit:FireFromWeaponCustom(1, getObj(Target):GetPosition())
							end
						end

						TActivate("CDHelicopters_Shooting_End")
					end
				end
			end

			LOG("Shooting 1183")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CDHelicopters_Shooting_End" active="0">
	<event timeout="0.25" eventid="GE_TIME_PERIOD" />
		<script>	
			LOG("Shooting End 1194")
			local Unit
			local Target
			local Friendlies = StringToTable(GetVar("Friendlies").AsString)
			local Enemies = StringToTable(GetVar("Enemies").AsString)

			local AliveFriendlies = {}
			local k = 1
			for i=1, 16 do
				if CheckUnits(Friendlies[i]) then
					AliveFriendlies[k] = Friendlies[i]

					k = k + 1
				end
			end

			local TargetEnemies = {}
			k = 0
			for i=31, 42 do
				if CheckUnits(Enemies[i]) then
					TargetEnemies[k] = Enemies[i]

					k = k + 1
				end
			end
			LOG("Shooting End 1219")

			if getn(AliveFriendlies)~=0 then
				if getn(TargetEnemies)~=0 then
					if CheckUnits(TargetEnemies, "alive", 1) then
						for i = 1, getn(AliveFriendlies) do
							Unit = AliveFriendlies[i]
							if CheckUnits(Unit) then
								-- Target Clarification
								-- get closest enemy
								-- put it into var
								-- Target = GetVar("cdhelicopter01_vehicle_0_target").AsString
								Target = GetVar(Unit.."_Target").AsString
								Unit = GetEntityByName(AliveFriendlies[i])

--								Unit:SetCustomControlWeaponsTargetObj(GetEntityByName(Target):GetId())
--								Unit:FireFromWeaponCustom2(1, GetEntityByName(Target):GetId())
								Unit:SetCustomControlWeaponsTarget(getObj(Target):GetPosition())
								Unit:FireFromWeaponCustom(1, getObj(Target):GetPosition())
								Unit:SetCustomControlWeapons(0)
								Unit:SetCustomControlEnabled(0)
							end
						end

						TActivate("CDHelicopters_Target")
					end
				end
			end

			LOG("Shooting End 1248")

			trigger:Deactivate()
		</script>
	</trigger>
-->
</triggers>