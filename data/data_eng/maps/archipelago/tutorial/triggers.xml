<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
	<trigger Name="GlobalVar" active="1">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			ChangeSide("CD")

			g_ObjCont:SetGameTime( 20, 49, 23, 4, 2265 )

			SetRadarUpgrade(1)
			
			SetWeather(0)

			RuleConsole("cinematic_spring_coeff 0.3")

			ShowMap()

			Radar:SetScanRadius(700)

			GetPlayerVehicle():setImmortalMode(1)
			GetPlayerVehicle():SetNameFromScript("MyCar")
			SetCameraBehindPlayerVehicle()
			TActivate("PlayerDead")

			local friendly = {}
			local enemy = {}
			--                {objName							Type				Prototype		EffHP VehHP FP Maneuv.		FriendlyName}
			friendly[1] = {"CDDestroyer01_vehicle_0", "CDDestroyerAegean", "Tutorial_DestroyerCD01", 1600, 1600, 6752, 22, "“Solido” (“Albedo”-class)"}
			friendly[2] = {"CDHeavyCruiser01_vehicle_0", "CDHCruiserAegean", "Tutorial_HCruiserCD01", 4000, 4000, 18551, 12, "“Valencia” (“Furia”-class)"}
			friendly[3] = {"CDHeavyCruiser02_vehicle_0", "CDHCruiserAegean", "Tutorial_HCruiserCD02", 4000, 4000, 18551, 12, "“Iberica” (“Furia”-class)"}
			friendly[4] = {"CDDestroyer02_vehicle_0", "CDDestroyerAegean", "Tutorial_DestroyerCD02", 1600, 1600, 6999, 22, "“Malvado” (“Albedo”-class)"}
			friendly[5] = {"CDDestroyer03_vehicle_0", "CDDestroyerAegean", "Tutorial_DestroyerCD03", 1600, 1600, 9827, 22, "“Enojado” (“Albedo”-class)"}
			friendly[6] = {"CDHeavyCruiser03_vehicle_0", "CDHCruiserAegean", "Tutorial_HCruiserCD03", 4000, 4000, 18551, 12, "“Valdivia” (“Furia”-class)"}
			--                {objName		EffHP VehHP FP Maneuv.}
			enemy[1] = {"CITBoat01_vehicle_0", 33, 125, 623, 55}
			enemy[2] = {"CITBoat02_vehicle_0", 33, 125, 623, 55}
			enemy[3] = {"CITBoat03_vehicle_0", 33, 125, 623, 55}
			enemy[4] = {"CITDestroyer01_vehicle_0", 1200, 1200, 6958, 26}
			enemy[5] = {"CITTorpedoBoat01_vehicle_0", 39, 300, 954, 80}
			enemy[6] = {"CITOldCruiser01_vehicle_0", 978, 978, 4892, 0}

			SetVar("MissionTime", 0)
			SetVar("RequiredMissionTime", 256) -- mission completion time (in s) for getting bonus score
			SetVar("BaseRetreatScore", 50) -- base retreat score that may get multiplied depending on 4 different factors
			SetVar("RequiredRetreatScore", 50) -- retreat score that needs to be reached for each friendly unit to successfully retreat
			SetVar("PlayerHealth", 1600)
			SetVar("PlayerVehicleHealth", 1600)
			SetVar("PlayerEndHealth", GetVar("PlayerHealth").AsInt)
			SetVar("PlayerName", "“Casado” (“Albedo”-class)")
			SetVar("Objectives", 4) -- amount of main objectives, excluding destruction of all enemy units and completing the mission without losses
			SetVar("ObjectiveScoreReward", 2500) -- how much score each objective gives
			SetVar("MissionScoreRewardMultiplier", 0.2) -- multiplier that determines how much money the player will receive for each score point

			local j = 1
			local friendlies = {}
			while friendly[j] do
				friendlies[j] = friendly[j][1]
				j = j + 1
			end
			friendlies = TableToString(friendlies)
			j = 1
			local friendliesTypes = {}
			while friendly[j] do
				friendliesTypes[j] = friendly[j][2]
				j = j + 1
			end
			friendliesTypes = TableToString(friendliesTypes)
			j = 1
			local friendliesPrototypes = {}
			while friendly[j] do
				friendliesPrototypes[j] = friendly[j][3]
				j = j + 1
			end
			friendliesPrototypes = TableToString(friendliesPrototypes)
			j = 1
			local friendliesHealth = {}
			while friendly[j] do
				friendliesHealth[j] = friendly[j][4]
				j = j + 1
			end
			friendliesHealth = TableToString(friendliesHealth)
			j = 1
			local friendliesVehicleHealth = {}
			while friendly[j] do
				friendliesVehicleHealth[j] = friendly[j][5]
				j = j + 1
			end
			friendliesVehicleHealth = TableToString(friendliesVehicleHealth)
			j = 1
			local friendliesFirepower = {}
			while friendly[j] do
				friendliesFirepower[j] = friendly[j][6]
				j = j + 1
			end
			friendliesFirepower = TableToString(friendliesFirepower)
			j = 1
			local friendliesManeuverability = {}
			while friendly[j] do
				friendliesManeuverability[j] = friendly[j][7]
				j = j + 1
			end
			friendliesManeuverability = TableToString(friendliesManeuverability)
			j = 1
			local friendliesNames = {}
			while friendly[j] do
				friendliesNames[j] = friendly[j][8]
				j = j + 1
			end
			friendliesNames = TableToString(friendliesNames)

			j = 1
			local enemies = {}
			while enemy[j] do
				enemies[j] = enemy[j][1]
				j = j + 1
			end
			enemies = TableToString(enemies)
			j = 1
			local enemiesHealth = {}
			while enemy[j] do
				enemiesHealth[j] = enemy[j][2]
				j = j + 1
			end
			enemiesHealth = TableToString(enemiesHealth)
			j = 1
			local enemiesVehicleHealth = {}
			while enemy[j] do
				enemiesVehicleHealth[j] = enemy[j][3]
				j = j + 1
			end
			enemiesVehicleHealth = TableToString(enemiesVehicleHealth)
			j = 1
			local enemiesFirepower = {}
			while enemy[j] do
				enemiesFirepower[j] = enemy[j][4]
				j = j + 1
			end
			enemiesFirepower = TableToString(enemiesFirepower)
			j = 1
			local enemiesManeuverability = {}
			while enemy[j] do
				enemiesManeuverability[j] = enemy[j][5]
				j = j + 1
			end
			enemiesManeuverability = TableToString(enemiesManeuverability)
			SetVar("TotalMissionScore", 0) -- total score gained, gets updated after mission stats calculation with the info about destroyed enemy units; score for enemy units is decided by their firepower
			SetVar("ObjectivesCompleted", 0)
			SetVar("Friendlies", friendlies)
			SetVar("FriendliesTypes", friendliesTypes)
			SetVar("FriendliesPrototypes", friendliesPrototypes)
			SetVar("FriendliesHealth", friendliesHealth) -- friendlies effective hp
			SetVar("FriendliesVehicleHealth", friendliesVehicleHealth) -- friendlies real hp according to the vehicle stats, used in UpdateUnitsStats
			SetVar("FriendliesEndHealth", friendliesHealth) -- friendlies hp at the end of the mission, are updated by UpdateUnitsStats
			SetVar("FriendliesFirepower", friendliesFirepower)
			SetVar("FriendliesManeuverability", friendliesManeuverability)
			SetVar("FriendliesNames", friendliesNames)
			SetVar("Enemies", enemies)
			SetVar("EnemiesHealth", enemiesHealth) -- enemies effective hp
			SetVar("EnemiesVehicleHealth", enemiesVehicleHealth) -- enemies real hp according to the vehicle stats, used in UpdateUnitsStats
			SetVar("EnemiesEndHealth", enemiesHealth) -- enemies hp at the end of the mission, are updated by UpdateUnitsStats
			SetVar("EnemiesFirepower", enemiesFirepower)
			SetVar("EnemiesManeuverability", enemiesManeuverability)
			

			if not getObj("ThePendulum") then
				CreateVehicleEx("PendulumVehicle01", "ThePendulum", CVector(30, 255, 80), 1486)
				local Maschine = getObj("ThePendulum")
				if Maschine then
					Maschine:setGodMode(1)
					Maschine:setImmortalMode(1)
					Maschine:SetExternalPathByName("PendulumPath")
					
					TActivate("trPendulum")
				end
			end

			SetVar("GunsGiven", 0)
			SetVar("TorpedoesGiven", 0)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trPendulum" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local Maschine = GetEntityByName("ThePendulum")
			if Maschine then
				Maschine:SetLinearVelocity(CVector(0, 0, 0))
				Maschine:SetExternalPathByName("PendulumPath")
				local PendulumStat = GetVar("PendulumStatus").AsInt
				local MissionTime = GetVar("MissionTime").AsInt
				if 50>PendulumStat then
					PendulumStat = PendulumStat + 1
					SetVar("PendulumStatus", PendulumStat)
					println("pendstat set to "..PendulumStat)
					MissionTime = MissionTime + 8
					SetVar("MissionTime", MissionTime)
				else
					SetVar("PendulumStatus", 0)
					println("corovan management activated, pendstat set to 0")
					MissionTime = MissionTime + 8
					SetVar("MissionTime", MissionTime)
				end
			end
		
		</script>
	</trigger>

	<trigger Name="trMusicManager" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<script>
			PlayMusic(GetVar("CustomMusicName").AsString)

		</script>
	</trigger>

	<trigger Name="MissionMusicStart" active="1">
		<event timeout="0.5" eventid="GE_TIME_PERIOD" />
		<script>
			PlayMusic("bs_attack_quiet")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RetreatStart" active="1">
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="MissionStartLoc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat01Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat02Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat03Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Retreat04Loc" />
		<script>
			TActivate("Retreat")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Retreat" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="MissionStartLoc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat03Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Retreat04Loc" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)

			UpdateUnitsStats()

			local b = SpawnMessageBox( "1000" )
			if b == 1 then
				trigger:Deactivate()

				if not(IsQuestTaken("CD_Tutorial_Retreat")) then
					FailQuest("CD_Tutorial")
				else
					CompleteQuest("CD_Tutorial_Retreat")
				end

				UpdateUnitsStats()

				CalcMissionStats()

				PassToMap("hq", "Headquarters_enter", 90, false )
			else
				trigger:Deactivate()

				TActivate("RetreatStart")
			end
			
		</script>
	</trigger>

	<trigger Name="Leave" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave03Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Leave04Loc" />
		<script>
			if not(IsQuestTaken("CD_Tutorial_Retreat")) then
				FailQuest("CD_Tutorial")
			else
				CompleteQuest("CD_Tutorial_Retreat")
			end

			UpdateUnitsStats()

			CalcMissionStats()

			PassToMap("hq", "Headquarters_enter", 90, false)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="WarningStart" active="0">
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning01Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning02Loc" />
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Warning03Loc" />
		<script>
			TActivate("Warning")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Warning" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Warning03Loc" />
		<script>
			local b = SpawnMessageBox( "1002" )

			TActivate("WarningStart")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Desertion" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion01Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion02Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion03Loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Desertion04Loc" />
		<script>
			if not(IsQuestTaken("CD_Tutorial_Retreat")) then
				FailQuest("CD_Tutorial")
			else
				FailQuest("CD_Tutorial_Retreat") -- the trigger is identical to Leave, besides this
			end

			UpdateUnitsStats(1) -- the trigger is identical to Leave, besides this

			CalcMissionStats(1) -- the trigger is identical to Leave, besides this

			PassToMap("hq", "Headquarters_enter", 90, false)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MissionStart" active="1">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			-- ================
			--  Main CD Force
			-- ================
			TeamCreate("CDDestroyer01", 1053, CVector(6930.860, 255, 467.227), {"Tutorial_DestroyerCD01"})
			CreateVehicleEx("Tutorial_HCruiserCD01", "CDHeavyCruiser01_vehicle_0", CVector(6077.110, 255, 1110.867), 1054)
			CreateVehicleEx("Tutorial_HCruiserCD02", "CDHeavyCruiser02_vehicle_0", CVector(5367.445, 255, 2187.295), 1054)
			TeamCreate("CDDestroyer02", 1053, CVector(5269.481, 255, 2008.623), {"Tutorial_DestroyerCD02"})
			TeamCreate("CDDestroyer03", 1053, CVector(5144.561, 255, 2205.522), {"Tutorial_DestroyerCD03"})
			TeamCreate("CDHeavyCruiser03", 1054, CVector(4914.408, 255, 2228.394), {"Tutorial_HCruiserCD03"})
			local CDD01 = getObj("CDDestroyer01")
			local CDD02 = getObj("CDDestroyer02")
			local CDD03 = getObj("CDDestroyer03")
			local CDHC03 = getObj("CDHeavyCruiser03")

			if CDD01 then
				CDD01:SetProperty ("TeamTacticPrototype", "StandardTactic")
				CDD01:_AdjustBehaviour ()
			end

			if CDD02 then
				CDD02:SetProperty ("TeamTacticPrototype", "StandardTactic")
				CDD02:_AdjustBehaviour ()
			end

			if CDD03 then
				CDD03:SetProperty ("TeamTacticPrototype", "StandardTactic")
				CDD03:_AdjustBehaviour ()
			end

			if CDHC03 then
				CDHC03:SetProperty ("TeamTacticPrototype", "CautiousTactic")
				CDHC03:_AdjustBehaviour ()
			end

			local CDD01a = getObj("CDDestroyer01_vehicle_0")
			local CDHC01a = getObj("CDHeavyCruiser01_vehicle_0")
			local CDHC02a = getObj("CDHeavyCruiser02_vehicle_0")
			local CDD02a = getObj("CDDestroyer02_vehicle_0")
			local CDD03a = getObj("CDDestroyer03_vehicle_0")
			local CDHC03a = getObj("CDHeavyCruiser03_vehicle_0")

			if CDD01a then
				CDD01a:SetRotation(Quaternion(0.0000, -0.3827, 0.0000, 0.9239))
				CDD01a:SetCruisingSpeed(12)
			end
			
			if CDHC01a then
				CDHC01a:SetRotation(Quaternion(0.0000, -0.9914, 0.0000, -0.1305))
				CDHC01a:SetCruisingSpeed(7)
				CDHC01a:SetCustomControlEnabled(1)
				CDHC01a:SetCustomControlWeapons(1)
				CDHC01a:SetCustomControlWeaponsTarget(CVector(5519, 340, 1204))
				CDHC01a:FireFromWeaponCustom(1, CVector(5519, 340, 1204))
			end

			if CDHC02a then
				CDHC02a:SetRotation(Quaternion(0.0000, -0.8788, 0.0000, -0.4772))
				CDHC02a:SetCruisingSpeed(7)
				CDHC02a:SetCustomControlEnabled(1)
				CDHC02a:SetCustomControlWeapons(1)
				CDHC02a:SetCustomControlWeaponsTarget(CVector(5300, 370, 1901))
				CDHC02a:FireFromWeaponCustom(1, CVector(5300, 370, 1901))
			end

			if CDD02a then
				CDD02a:SetRotation(Quaternion(0.0000, 0.8660, 0.0000, 0.5000))
				CDD02a:SetCruisingSpeed(7)
			end

			if CDD03a then
				CDD03a:SetRotation(Quaternion(0.0000, 0.8660, 0.0000, 0.5000))
				CDD03a:SetCruisingSpeed(7)
			end

			if CDHC03a then
				CDHC03a:SetRotation(Quaternion(0.0000, 0.8660, 0.0000, 0.5000))
				CDHC03a:SetCruisingSpeed(7)
			end

			-- ===============
			--  Main CIT Force
			-- ===============
			TeamCreate("CITBoat01", 1002, CVector(6591, 255, 2899), {"Tutorial_SmlboatCIT01"})
			TeamCreate("CITBoat02", 1002, CVector(6597, 255, 2956), {"Tutorial_SmlboatCIT01"})
			TeamCreate("CITBoat03", 1002, CVector(6649, 255, 2918), {"Tutorial_SmlboatCIT01"})
			TeamCreate("CITDestroyer01", 1003, CVector(6938, 255, 2846), {"Tutorial_DestroyerCIT01"})
			TeamCreate("CITTorpedoBoat01", 1002, CVector(6701, 255, 2877), {"Tutorial_FastboatCIT01"})
			TeamCreate("CITOldCruiser01", 1004, CVector(6818, 255, 2914), {"Tutorial_OCruiserCIT01"})

			local CITB01 = getObj("CITBoat01")
			local CITB02 = getObj("CITBoat02")
			local CITB03 = getObj("CITBoat03")
			local CITD01 = getObj("CITDestroyer01")
			local CITTB01 = getObj("CITTorpedoBoat01")
			local CITOC01 = getObj("CITOldCruiser01")

			if CITB01 then
				CITB01:SetProperty ("TeamTacticPrototype", "StandardTactic")
				CITB01:_AdjustBehaviour ()
			end

			if CITB02 then
				CITB02:SetProperty ("TeamTacticPrototype", "StandardTactic")
				CITB02:_AdjustBehaviour ()
			end

			if CITB03 then
				CITB03:SetProperty ("TeamTacticPrototype", "StandardTactic")
				CITB03:_AdjustBehaviour ()
			end

			if CITD01 then
				CITD01:SetProperty ("TeamTacticPrototype", "StandardTactic")
				CITD01:_AdjustBehaviour ()
			end

			if CITTB01 then
				CITTB01:SetProperty ("TeamTacticPrototype", "AssaultBottomTactic")
				CITTB01:_AdjustBehaviour ()
			end

			if CITOC01 then
				CITOC01:SetProperty ("TeamTacticPrototype", "CowardTeamTactic")
				CITOC01:_AdjustBehaviour ()
			end

			local CITB01a = getObj("CITBoat01_vehicle_0")
			local CITB02a = getObj("CITBoat02_vehicle_0")
			local CITB03a = getObj("CITBoat03_vehicle_0")
			local CITD01a = getObj("CITDestroyer01_vehicle_0")
			local CITTB01a = getObj("CITTorpedoBoat01_vehicle_0")
			local CITOC01a = getObj("CITOldCruiser01_vehicle_0")

			if CITB01a then
				CITB01a:SetRotation(Quaternion(0.0000, -0.8714, 0.0000, 0.4905))
				CITB01a:SetCruisingSpeed(8)
			end

			if CITB02a then
				CITB02a:SetRotation(Quaternion(0.0000, -0.8714, 0.0000, 0.4905))
				CITB02a:SetCruisingSpeed(8)
			end

			if CITB03a then
				CITB03a:SetRotation(Quaternion(0.0000, -0.8714, 0.0000, 0.4905))
				CITB03a:SetCruisingSpeed(8)
			end

			if CITD01a then
				CITD01a:SetRotation(Quaternion(0.0000, -0.8141, 0.0000, 0.5807))
				CITD01a:SetCruisingSpeed(8)
			end

			if CITTB01a then
				CITTB01a:SetRotation(Quaternion(0.0000, -0.8538, 0.0000, 0.5206))
				CITTB01a:SetCruisingSpeed(8)
			end

			if CITOC01a then
				CITOC01a:SetRotation(Quaternion(0.0000, -0.5736, 0.0000, 0.8192))
--				CITOC01a:SetMaxSpeed(0)
				CITOC01a:SetMaxTorque(1)
				CITOC01a:AddModifier("hp", "= 978")
--				CITOC01a:AddModifier("maxhp", "= 978")
			end

			-- =============
			--  CIT Reserves
			-- =============

			-- =========
			--  Trigger
			-- =========
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetCruisingSpeed(25)
				Plf:SetExternalPathByName("StartPath_Player")
			end
			local PlfID = GetPlayerVehicleId()
			FlyLinked( "Tutorial_Start1", PlfID, 21+12, 0, 1, PlfID )
			StartCinematic()

			AddCinematicMessage( 1, 2)
			AddCinematicMessage( 2, 1)
			AddCinematicMessage( 3, 1)

			TActivate("MissionStart_End")

			local fireEffectsList = { "ET_PS_VEH_EXP_WHEEL_BIG",
								"ET_PS_VEH_EXP_WHEEL_MED",
								"ET_PS_VEH_EXP_WHEEL_SMALL",
								"ET_PS_VEH_EXP_WHEEL1_BIG",
								"ET_PS_VEH_EXP_WHEEL1_MED",
								"ET_PS_VEH_EXP_WHEEL1_SMALL" }

			local fireEffectsCoords = { CVector(5317, 276, 1207),
										CVector(5319, 276, 1210),
										CVector(5305, 279, 1212),		
										CVector(5287, 282, 1214),		
										CVector(5283, 282, 1214),		
										CVector(5279, 284, 1204),		
										CVector(5278, 284, 1206),
										CVector(5273, 283, 1222),
										CVector(5270, 287, 1220),
										CVector(5272, 285, 1217),
										CVector(5270, 285, 1213),
										CVector(5289, 283, 1244),
										CVector(5284, 281, 1244),
										CVector(5260, 285, 1227),
										CVector(5257, 285, 1230),
										CVector(5259, 283, 1232),
										CVector(5249, 284, 1229),
										CVector(5253, 283, 1245),
										CVector(5254, 283, 1250),
										CVector(5248, 284, 1249),
										CVector(5275, 284, 1260),
										CVector(5278, 282, 1266),
										CVector(5271, 283, 1274),
										CVector(5244, 285, 1258),
										CVector(5249, 285, 1284),
										CVector(5247, 286, 1286),
										CVector(5240, 285, 1285),
										CVector(5228, 285, 1261),
										CVector(5223, 286, 1255),
										CVector(5210, 283, 1271),
										CVector(5207, 284, 1254),
										CVector(5213, 285, 1300),
										CVector(5203, 285, 1302),
										CVector(5185, 284, 1274),
										CVector(5185, 283, 1281),
										CVector(5170, 283, 1312),
										CVector(5165, 283, 1282),
										CVector(5164, 284, 1277),
										CVector(5145, 282, 1309),
										CVector(5148, 284, 1284),
										CVector(5120, 275, 1307) }

			for i=1, getn(fireEffectsCoords) do
				CreateNewSgNodeObject(fireEffectsList[exrandom(getn(fireEffectsList))], "FireEffect"..i, -1, -1, fireEffectsCoords[i], Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MissionStart_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:PlaceToEndOfPath("StartPath_Player")
				Plf:AddModifier("fuel", "+ 6271337")
				Plf:AddModifier("fuel", "- 126")
			end

			local b = SpawnMessageBox ("101")
			if b == 1 then
				local CDD01a = getObj("CDDestroyer01_vehicle_0")
				local CDD02a = getObj("CDDestroyer02_vehicle_0")
				local CDD03a = getObj("CDDestroyer03_vehicle_0")
				local CDHC03a = getObj("CDHeavyCruiser03_vehicle_0")

				if CDD01a then
					CDD01a:SetExternalPathByName("CDDestroyer01_Waypoint1")
					CDD01a:SetCanBeDistractedFromMoving(true)
					CDD01a:SetCruisingSpeed(12)
				end

				if CDD02a then
					CDD02a:SetExternalPathByName("CDDestroyer02_Waypoint1")
					CDD02a:SetCanBeDistractedFromMoving(true)
					CDD02a:SetCruisingSpeed(7)
				end

				if CDD03a then
					CDD03a:SetExternalPathByName("CDDestroyer03_Waypoint1")
					CDD03a:SetCanBeDistractedFromMoving(true)
					CDD03a:SetCruisingSpeed(7)
				end

				if CDHC03a then
					CDHC03a:SetExternalPathByName("CDHeavyCruiser03_Waypoint1")
					CDHC03a:SetCanBeDistractedFromMoving(true)
					CDHC03a:SetCruisingSpeed(7)
				end

				local CITB01 = getObj("CITBoat01")
				local CITB02 = getObj("CITBoat02")
				local CITB03 = getObj("CITBoat03")

				if CITB01 then
					CITB01:StackOpen()
					CITB01:SetDestination(CVector(5466.915, 255, 2229.823))
					CITB01:StackClose()
				end

				if CITB02 then
					CITB02:StackOpen()
					CITB02:SetDestination(CVector(5472.298, 255, 2286.279))
					CITB02:StackClose()
				end

				if CITB03 then
					CITB03:StackOpen()
					CITB03:SetDestination(CVector(5525.097, 255, 2248.648))
					CITB03:StackClose()
				end
				
				TActivate("BoatsDestroyed")
				TActivate("DestroyerDestroyed")
				TActivate("CruiserDestroyed")
				TActivate("FormationSpeedMaintainer")
				TActivate("CinematicArtillery")

				b = SpawnMessageBox ("102")
				if b == 1 then
					TakeQuest("CD_Tutorial")

					TActivate("NoticeBoats")
					TActivate("PlayerDamaged")				
				end
			else
--				g_Console:executeCommand("/map hq")
				UpdateUnitsStats()

				CalcMissionStats()

				PassToMap("hq", "Headquarters_enter", 90, true)
			end

			SetCameraBehindPlayerVehicle()

			SetVar("MissionTime", 0)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="FormationSpeedMaintainer" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<script>	
			local CDD01a = getObj("CDDestroyer01_vehicle_0")
			local CDD02a = getObj("CDDestroyer02_vehicle_0")
			local CDD03a = getObj("CDDestroyer03_vehicle_0")
			local CDHC03a = getObj("CDHeavyCruiser03_vehicle_0")

			if CDD01a then
				CDD01a:SetCruisingSpeed(12)
			end

			if CDD02a then
				CDD02a:SetCruisingSpeed(7)
			end

			if CDD03a then
				CDD03a:SetCruisingSpeed(7)
			end

			if CDHC03a then
				CDHC03a:SetCruisingSpeed(7)
			end

			local CITB01a = getObj("CITBoat01_vehicle_0")
			local CITB02a = getObj("CITBoat02_vehicle_0")
			local CITB03a = getObj("CITBoat03_vehicle_0")
			local CITD01a = getObj("CITDestroyer01_vehicle_0")
			local CITTB01a = getObj("CITTorpedoBoat01_vehicle_0")

			if CITB01a then
				CITB01a:SetCruisingSpeed(8)
			end

			if CITB02a then
				CITB02a:SetCruisingSpeed(8)
			end

			if CITB03a then
				CITB03a:SetCruisingSpeed(8)
			end

			if CITD01a then
				CITD01a:SetCruisingSpeed(12)
			end

			if CITTB01a then
				CITTB01a:SetCruisingSpeed(8)
			end

		</script>
	</trigger>

	<trigger Name="CinematicArtillery" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<script>	
			local CDHC01a = GetEntityByName("CDHeavyCruiser01_vehicle_0")
			if CDHC01a then
				CDHC01a:SetCustomControlEnabled(1)
				CDHC01a:SetCustomControlWeapons(1)
				CDHC01a:SetCustomControlWeaponsTarget(CVector(5519, 340, 1204))
				CDHC01a:FireFromWeaponCustom(1, CVector(5519, 340, 1204))
			end

			local CDHC02a = GetEntityByName("CDHeavyCruiser02_vehicle_0")
			if CDHC02a then
				CDHC02a:SetCustomControlEnabled(1)
				CDHC02a:SetCustomControlWeapons(1)
				CDHC02a:SetCustomControlWeaponsTarget(CVector(5300, 370, 1901))
				CDHC02a:FireFromWeaponCustom(1, CVector(5300, 370, 1901))
			end

			TActivate("CinematicArtillery_End")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CinematicArtillery_End" active="0">
	<event timeout="0.5" eventid="GE_TIME_PERIOD" />
		<script>	
			local CDHC01a = GetEntityByName("CDHeavyCruiser01_vehicle_0")
			if CDHC01a then
				CDHC01a:SetCustomControlWeaponsTarget(CVector(5499, 340, 1224))
				CDHC01a:FireFromWeaponCustom(1, CVector(5499, 340, 1224))
				CDHC01a:SetCustomControlWeapons(0)
				CDHC01a:SetCustomControlEnabled(0)
			end

			local CDHC02a = GetEntityByName("CDHeavyCruiser02_vehicle_0")
			if CDHC02a then
				CDHC02a:SetCustomControlWeaponsTarget(CVector(5290, 370, 1891))
				CDHC02a:FireFromWeaponCustom(1, CVector(5290, 370, 1891))
				CDHC02a:SetCustomControlWeapons(0)
				CDHC02a:SetCustomControlEnabled(0)
			end

			TActivate("CinematicArtillery")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="GiveGuns" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>	
			local Plf = GetPlayerVehicle()

			if GetVar("GunsGiven").AsInt ~= 1 then
				for i=1, 4 do
					Plf:SetNewPart("CHASSIS_TURRET_GUN_"..i, "twin127CD01")
				end

				for i=0, 3 do
					Plf:SetNewPart("BASKET_SMALL_GUN_"..i, "mun_twin127CD01")
				end

				SetVar("GunsGiven", 1)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="GiveTorpedoes" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>	
			local Plf = GetPlayerVehicle()
			
			if GetVar("TorpedoesGiven").AsInt ~= 1 then
				Plf:SetNewPart("CHASSIS_GIANT_GUN_1", "destroyerCDTorpedo01")
				Plf:SetNewPart("CHASSIS_SIDE_GUN_1", "destroyerCDTorpedo01")

				SetVar("TorpedoesGiven", 1)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="NoticeBoats" active="0">
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITBoat01_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITBoat02_vehicle_0" />
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITBoat03_vehicle_0" />
		<script>	
			UpdateUnitsStats()

			local b = SpawnMessageBox ("103")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="PlayerDamaged" active="0">
		<event eventid="GE_UNDER_ATTACK" ObjName="MyCar" />
		<script>	
			UpdateUnitsStats()

			local Plf = GetPlayerVehicle()
			local CurHealth = Plf:GetHealth()
			local MaxHealth = GetVar("PlayerVehicleHealth").AsInt
			if MaxHealth > CurHealth then
				local b = SpawnMessageBox ("104")
				if b == 1 then
					PlayMusic("bs_attack_combat")

					trigger:Deactivate()
				end
			end

		</script>
	</trigger>

	<trigger Name="BoatsDestroyed" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITBoat01" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITBoat02" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITBoat03" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)
			local TargetEnemies = {Enemies[1],Enemies[2],Enemies[3]}
			local Destroyer = Enemies[4]

			if CheckUnits(TargetEnemies, "dead", 3) then
				UpdateUnitsStats()

				CompleteQuest("CD_Tutorial_DestroyBoats")

				local b = SpawnMessageBox ("105")

				if CheckUnits(Destroyer, "alive", 1) then
					local CITD01a = getObj("CITDestroyer01_vehicle_0")

					if CITD01a then
						CITD01a:SetExternalPathByName("CITDestroyer01_Waypoint1")
						CITD01a:SetCanBeDistractedFromMoving(true)
					end

					TakeQuest("CD_Tutorial_DestroyDestroyer")

					TActivate("NoticeDestroyer")
				else
					CompleteQuest("CD_Tutorial_DestroyDestroyer")

					TakeQuest("CD_Tutorial_DestroyCruiser")

					TActivate("NoticeCruiser")
					TActivate("GiveTorpedoes")
				end

				local CITTB01 = getObj("CITTorpedoBoat01")

				if CITTB01 then
					CITTB01:StackOpen()
					CITTB01:SetDestination(CVector(5400.073, 255, 2209.322))
					CITTB01:StackClose()
				end

				TActivate("EnojadoRetreat")
				TActivate("GiveGuns")

				PlayMusic("bs_attack_quiet")

				trigger:Deactivate()
			end

		</script>
	</trigger>

	<trigger Name="EnojadoRetreat" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<script>
			local CDD03 = getObj("CDDestroyer03")
			local CDD03a = getObj("CDDestroyer03_vehicle_0")
			println("speed check")
			if 3 > GetSpeed(CDD03a) then
				println("speed check passed")
				if CDD03 then
					CDD03:SetProperty ("TeamTacticPrototype", "CowardTeamTactic")
					CDD03:_AdjustBehaviour ()
				end

				if CDD03a then
					CDD03a:SetCustomControlEnabled(true)
					CDD03a:SetCanBeDistractedFromMoving(false)
					CDD03a:SetExternalPathByName("CDDestroyer03_Waypoint2")
				end

				trigger:Deactivate()
			end

		</script>
	</trigger>

	<trigger Name="NoticeDestroyer" active="0">
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITDestroyer01_vehicle_0" />
		<script>	
			UpdateUnitsStats()

			PlayMusic("bs_attack_combat")

			local b = SpawnMessageBox ("106")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="DestroyerDestroyed" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITDestroyer01" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)
			local TargetEnemies = {Enemies[4]}
			local Cruiser = Enemies[6]

			if CheckUnits(TargetEnemies, "dead") then
				UpdateUnitsStats()

				CompleteQuest("CD_Tutorial_DestroyDestroyer")

				local b = SpawnMessageBox ("107")
				if b == 1 then
					b = SpawnMessageBox ("108")
				end

				if CheckUnits(Cruiser, "alive") then
					TakeQuest("CD_Tutorial_DestroyCruiser")

					TActivate("NoticeCruiser")
				else
					CompleteQuest("CD_Tutorial_DestroyCruiser")
				end

				TActivate("GiveGuns")
				TActivate("GiveTorpedoes")

				trigger:Deactivate()
			end

		</script>
	</trigger>

	<trigger Name="NoticeCruiser" active="0">
		<event eventid="GE_NOTICE_ENEMY" ObjName="CITOldCruiser01_vehicle_0" />
		<script>	
			UpdateUnitsStats()

			local b = SpawnMessageBox ("109")
			if b == 1 then
				b = SpawnMessageBox ("110")
				if b == 1 then
					b = SpawnMessageBox ("111")
					if b == 1 then
						TActivate("GiveTorpedoes")
					end
				end
			end

			PlayMusic("bs_attack_combat")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CruiserDestroyed" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="ThePendulum" />
		<event eventid="GE_OBJECT_DIE" ObjName="CITOldCruiser01" />
		<script>
			local Enemies = StringToTable(GetVar("Enemies").AsString)
			local TargetEnemies = {Enemies[6]}

			if CheckUnits(TargetEnemies, "dead", 1) then
				UpdateUnitsStats()

				CompleteQuest("CD_Tutorial_DestroyCruiser")

				TDeactivate("CinematicArtillery")
				TDeactivate("CinematicArtillery_End")

				local CDD01a = getObj("CDDestroyer01_vehicle_0")
				local CDHC01a = getObj("CDHeavyCruiser01_vehicle_0")
				local CDHC02a = getObj("CDHeavyCruiser02_vehicle_0")

				if CDD01a then
					CDD01a:SetExternalPathByName("CDDestroyer01_Waypoint1")
				end

				if CDHC01a then
					CDHC01a:SetCustomControlWeaponsTarget(CVector(5399, 340, 1224))
					CDHC01a:FireFromWeaponCustom(1, CVector(5399, 340, 1224))
					CDHC01a:SetCustomControlWeapons(0)
					CDHC01a:SetCustomControlEnabled(0)
					CDHC01a:SetExternalPathByName("CDHeavyCruiser01_Waypoint1")
				end

				if CDHC02a then
					CDHC02a:SetCustomControlWeaponsTarget(CVector(5190, 370, 1891))
					CDHC02a:FireFromWeaponCustom(1, CVector(5190, 370, 1891))
					CDHC02a:SetCustomControlWeapons(0)
					CDHC02a:SetCustomControlEnabled(0)
					CDHC02a:SetExternalPathByName("CDHeavyCruiser02_Waypoint1")
				end

				PlayMusic("bs_attack_quiet")

				if (IsQuestComplete("CD_Tutorial_DestroyDestroyer") and IsQuestComplete("CD_Tutorial_DestroyBoats")) then
					local b = SpawnMessageBox ("112")
					if b == 1 then
						if CheckDistBetweenUnits(GetPlayerVehicle(), Enemies, "least") > 1000 then
							b = SpawnMessageBox ("113")
							b = SpawnMessageBox( "1001" )
							println("mission end 0")
							if b == 1 then
								trigger:Deactivate()
		
								CompleteQuestIfTaken("CD_Tutorial_Retreat")
		
								println("mission end 1")
		
								GiveScore(3000)
		
								println("mission end 2")

								UpdateUnitsStats()
		
								CalcMissionStats()
		
								println("mission end 3")

								gTutorialCompleted = 1
		
								PassToMap("hq", "Headquarters_enter", 90, false )
							end
						else
							SpawnMessageBox ("114")
						end
						
					end
				end

				trigger:Deactivate()
			end

		</script>
	</trigger>
</triggers>