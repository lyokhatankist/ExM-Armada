<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
	<trigger Name="GlobalVar" active="1">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("OnMission", 0)

			SetVar("CDTotalPoints", 0)
			SetVar("CDTotalManpowerLosses", 0)
			SetVar("CDTotalEquipmentLosses", 0)
			SetVar("CDTotalManpowerDestroyed", 0)
			SetVar("CDTotalEquipmentDestroyed", 0)

			SetVar("CITTotalPoints", 0)
			SetVar("CITTotalManpowerLosses", 0)
			SetVar("CITTotalEquipmentLosses", 0)
			SetVar("CITTotalManpowerDestroyed", 0)
			SetVar("CITTotalEquipmentDestroyed", 0)

			g_ObjCont:SetGameTime( 7, 0, 29, 3, 2265 )

			SetRadarUpgrade(1)

			Radar:SetScanRadius(1000)

			ShowMap()

			Journal:AddClanToEncyclopaedia(1000)
			Journal:AddClanToEncyclopaedia(1050)

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				AddPlayerVehicle("HQVehicle01")
				local vehPlayerNew = GetPlayerVehicle()
				if vehPlayerNew then
					vehPlayerNew:SetGamePositionOnGround(CVector(1024, 275, 1024))
					vehPlayerNew:SetCustomLinearVelocity(0)
					vehPlayerNew:SetThrottle(0)
				end
			end

			println("jopka")

			if (IsQuestComplete("CD_Tutorial") or IsQuestFailed("CD_Tutorial")) then
				TActivate("ShowMissionStats_Tutorial")
			end

			println("jopka")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trMusicManager" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			TActivate("trMusicManager_II")

		</script>
	</trigger>

	<trigger Name="trMusicManager_II" active="0">
		<event timeout="0.05" eventid="GE_TIME_PERIOD" />
		<script>
			CustomMusicName = "nomusic"

			StopPlayingCustomMusic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ShowMissionStats_Tutorial" active="0">
		<event timeout="0.05" eventid="GE_TIME_PERIOD" />
		<script>
			local b = SpawnMessageBox( "101" )
			if b == 1 then
				b = SpawnMessageBox( "102" )
				if b == 1 then
					b = SpawnMessageBox( "103" )
					if b == 1 then
						b = SpawnMessageBox( "104" )
						if b == 1 then
							ShowMissionStats()

							local items = {
											"ddguns_upgrade",
											"antiair_basic",
											"fuel_basic"
										}
	
							AddRewardItems(items)
						end
					end
				end
			end

			Radar:SetScanRadius(1000)
			
			trigger:Deactivate()
		</script>
	</trigger>

<!-- "7 Махов". Установка текущей погоды при выезде из городов для устранения случайных сбоев гаммы окружающего пространства.-->
	<trigger	Name="trExitFromTowns" 	active="1">
		<event	eventid="GE_LEAVE_TOWN"	ObjName="Headquarters"	/>
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				local playerPos = vehPlayer:GetPosition()
				vehPlayer:SetGamePositionOnGround(playerPos)
				vehPlayer:SetCustomLinearVelocity(0)
				vehPlayer:SetThrottle(0)
			end

			UpdateWeather()
		</script>
	</trigger>
<!-- "7 Махов". -->
	<trigger Name="MissionStart" active="0">
		<event	eventid="GE_LEAVE_TOWN"	ObjName="Headquarters" />
		<script>
			TDeactivate("trMusicManager_II")

			CustomMusicName = "nomusic"

			StopPlayingCustomMusic()
			
			local missionLoc = GetVar("MissionLoc").AsString
			local b = SpawnMessageBox( "1000" )
			if b == 1 then
				local missionParams = StringToTable(GetVar("MissionParams").AsString)
				gMissionTime = StringToTable(missionParams[1])
				SetVar("OnMission", 0)
				TActivate(missionParams[3])
				TActivate("ShowMissionStats")

				-- Converge reward item tables

				trigger:Deactivate()
				
				PassToMap(missionLoc, "MissionStartLoc", nil, true )
			end

		</script>
	</trigger>

	<trigger Name="ShowMissionStats" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local OnMission = GetVar("OnMission").AsInt
			if OnMission ~= 1 then
				local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
					local playerPos = vehPlayer:GetPosition()
					AddPlayerVehicle("HQVehicle01")
					vehPlayer = GetPlayerVehicle()
					vehPlayer:SetGamePositionOnGround(playerPos)
					vehPlayer:SetCustomLinearVelocity(0)
					vehPlayer:SetThrottle(0)
				end

				TActivate("ShowMissionStats_II")
			end

		</script>
	</trigger>

	<trigger Name="ShowMissionStats_II" active="0">
		<event timeout="0.05" eventid="GE_TIME_PERIOD" />
		<script>
			ShowMissionStats()

			Radar:SetScanRadius(1000)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MyFinalMessageGoodbye" active="0">
		<event timeout="0.07" eventid="GE_TIME_PERIOD" />
		<script>
			println("Change the world. My final message.")
			LOG("Change the world. My final message.")
			AddImportantFadingMsgByStrIdFormatted("fm_empty")
			AddImportantFadingMsgByStrIdFormatted("fm_empty")
			AddImportantFadingMsgByStrIdFormatted("fm_empty")
			AddImportantFadingMsgByStrIdFormatted("fm_empty")
			AddFadingMsgByStrIdFormatted("fm_empty")
			AddFadingMsgByStrIdFormatted("fm_empty")
			AddFadingMsgByStrIdFormatted("fm_empty")
			AddFadingMsgByStrIdFormatted("fm_empty")
			local b = SpawnMessageBox( "1486" )
			if b == 1 then
				AddFadingMsgByStrIdFormatted("fm_missionstats_points", GetVar("CITTotalPoints").AsInt)
				AddFadingMsgByStrIdFormatted("fm_missionstats_allieslost_manpower", GetVar("CITTotalManpowerLosses").AsInt)
				AddFadingMsgByStrIdFormatted("fm_missionstats_enemiesdestroyed_manpower", GetVar("CITTotalManpowerDestroyed").AsInt)
				AddFadingMsgByStrIdFormatted("fm_empty")
				b = SpawnMessageBox( "1487" )
				if b == 1 then
					AddFadingMsgByStrIdFormatted("fm_missionstats_points", GetVar("CDTotalPoints").AsInt)
					AddFadingMsgByStrIdFormatted("fm_missionstats_allieslost_manpower", GetVar("CDTotalManpowerLosses").AsInt)
					AddFadingMsgByStrIdFormatted("fm_missionstats_enemiesdestroyed_manpower", GetVar("CDTotalManpowerDestroyed").AsInt)
					AddFadingMsgByStrIdFormatted("fm_empty")
					b = SpawnMessageBox( "1488" )
				end
			end
			println("Goodbye.")
			LOG("Goodbye.")

			PlayCustomMusic("bs_bar")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="HQMove" active="1">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>
			local HQ = getObj("Headquarters")
			if HQ then
				HQ:SetPosition(CVector(2448, 275, 2448))
			end

			PlayMusic("nomusic")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CITPH01_Counterattack" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local items = {
							"antiair_upgrade",
							"clguns_upgrade",
							"smlboatCITMachinegun01",
							"AA47mmCannon01",
							"antiair_basic"
						  }

			if IsQuestComplete("CIT_PH01_DestroyTargets") then
				AddRewardItems(items)

				AddBook("book_citph01_success")
			end

			-- the thank you message
			local PHMissionsComplete = GetVar("PHMissionsComplete").AsInt
			if PHMissionsComplete ~= -1 then
				PHMissionsComplete = PHMissionsComplete + 1
				println("some missions were completed before, setting to "..PHMissionsComplete)
				LOG("some missions were completed before, setting to "..PHMissionsComplete)
				SetVar("PHMissionsComplete", PHMissionsComplete)
			else
				println("no missions were completed before, setting to 1")
				LOG("no missions were completed before, setting to 1")
				SetVar("PHMissionsComplete", 1)
			end

			if PHMissionsComplete >= 7 then
				TActivate("MyFinalMessageGoodbye")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CITPH02_Guests" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local items = {
							"caguns_upgrade",
							"mun_single130CIT01",
							"mun_single130CIT01",
							"AADuet01",
							"AADuet01",
							"AA47mmCannon01",
							"hp_basic",
							"ddguns_basic"
						  }

			if IsQuestComplete("CIT_PH02_DestroyFleet") then
				AddRewardItems(items)

				AddBook("book_citph02_success")
			else
				AddBook("book_citph02_failure")
			end

			-- the thank you message
			local PHMissionsComplete = GetVar("PHMissionsComplete").AsInt
			if PHMissionsComplete ~= -1 then
				PHMissionsComplete = PHMissionsComplete + 1
				println("some missions were completed before, setting to "..PHMissionsComplete)
				LOG("some missions were completed before, setting to "..PHMissionsComplete)
				SetVar("PHMissionsComplete", PHMissionsComplete)
			else
				println("no missions were completed before, setting to 1")
				LOG("no missions were completed before, setting to 1")
				SetVar("PHMissionsComplete", 1)
			end

			if PHMissionsComplete >= 7 then
				TActivate("MyFinalMessageGoodbye")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CITPH03_March" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local items = {
							"fuel_upgrade",
							"mun_single130CIT02",
							"mun_single130CIT02",
							"AA47mmCannon01",
							"smlboatCITRocket01"
						  }

			if IsQuestComplete("CIT_PH03_DestroyMerchants") then
				if IsQuestComplete("CIT_PH03_DestroyCruisers") and not(IsQuestFailed("CIT_PH03_Retreat")) then
					items = ConvergeTables(items, {"smlboatCITRocket01","AA120mmSAMCIT01","AA120mmSAMCIT01"})

					AddBook("book_citph03_victory")
				end

				AddRewardItems(items)

				AddBook("book_citph03_success")
			else
				AddBook("book_citph03_failure")
			end

			-- the thank you message
			local PHMissionsComplete = GetVar("PHMissionsComplete").AsInt
			if PHMissionsComplete ~= -1 then
				PHMissionsComplete = PHMissionsComplete + 1
				println("some missions were completed before, setting to "..PHMissionsComplete)
				LOG("some missions were completed before, setting to "..PHMissionsComplete)
				SetVar("PHMissionsComplete", PHMissionsComplete)
			else
				println("no missions were completed before, setting to 1")
				LOG("no missions were completed before, setting to 1")
				SetVar("PHMissionsComplete", 1)
			end

			if PHMissionsComplete >= 7 then
				TActivate("MyFinalMessageGoodbye")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CITPH04_Routine" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local items = {
							"torpedo_upgrade",
							"smlboatCITMachinegun01",
							"smlboatCITMachinegun01",
							"smlboatCITRocket01"
						  }

			if IsQuestComplete("CIT_PH04_DestroyMerchants") then
				AddRewardItems(items)

				AddBook("book_citph04_success")
			else
				AddBook("book_citph04_failure")
			end

			-- the thank you message
			local PHMissionsComplete = GetVar("PHMissionsComplete").AsInt
			if PHMissionsComplete ~= -1 then
				PHMissionsComplete = PHMissionsComplete + 1
				println("some missions were completed before, setting to "..PHMissionsComplete)
				LOG("some missions were completed before, setting to "..PHMissionsComplete)
				SetVar("PHMissionsComplete", PHMissionsComplete)
			else
				println("no missions were completed before, setting to 1")
				LOG("no missions were completed before, setting to 1")
				SetVar("PHMissionsComplete", 1)
			end

			if PHMissionsComplete >= 7 then
				TActivate("MyFinalMessageGoodbye")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CDPH01_Garrison" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local items = {
							"bbguns_upgrade",
							"mun_twin127CD01",
							"mun_twin127CD01",
							"mun_twin356CD02",
							"AA152mmATGMCD01",
							"AA152mmATGMCD01"
						  }

			if IsQuestComplete("CD_PH01_EscortFirst") or IsQuestComplete("CD_PH01_EscortSecond") then
				AddRewardItems(items)

				AddBook("book_cdph01_success")
				if IsQuestComplete("CD_PH01_DestroyDestroyers") and IsQuestComplete("CD_PH01_DestroyTurrets") and IsQuestComplete("CD_PH01_DestroyCruisers") and IsQuestComplete("CD_PH01_DestroyBoats") then
					AddBook("book_cdph01_victory")
				end
			else
				if not(IsQuestComplete("CD_PH01_DestroyCruisers")) then
					AddBook("book_cdph01_failure")
				end
			end

			-- the thank you message
			local PHMissionsComplete = GetVar("PHMissionsComplete").AsInt
			if PHMissionsComplete ~= -1 then
				PHMissionsComplete = PHMissionsComplete + 1
				println("some missions were completed before, setting to "..PHMissionsComplete)
				LOG("some missions were completed before, setting to "..PHMissionsComplete)
				SetVar("PHMissionsComplete", PHMissionsComplete)
			else
				println("no missions were completed before, setting to 1")
				LOG("no missions were completed before, setting to 1")
				SetVar("PHMissionsComplete", 1)
			end

			if PHMissionsComplete >= 7 then
				TActivate("MyFinalMessageGoodbye")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CDPH02_Fortress" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local items = {
							"anti_missile_system",
							"mun_twin356CD02",
							"mun_twin356CD02",
							"smlboatCDMachinegun01",
							"smlboatCDMachinegun01",
							"smlboatCDRocket01",
							"smlboatCDRocket01"
						  }

			if IsQuestComplete("CD_PH02_DestroyTurrets") then
				AddRewardItems(items)

				AddBook("book_cdph02_success")
			else
				AddBook("book_cdph02_failure")
			end

			-- the thank you message
			local PHMissionsComplete = GetVar("PHMissionsComplete").AsInt
			if PHMissionsComplete ~= -1 then
				PHMissionsComplete = PHMissionsComplete + 1
				println("some missions were completed before, setting to "..PHMissionsComplete)
				LOG("some missions were completed before, setting to "..PHMissionsComplete)
				SetVar("PHMissionsComplete", PHMissionsComplete)
			else
				println("no missions were completed before, setting to 1")
				LOG("no missions were completed before, setting to 1")
				SetVar("PHMissionsComplete", 1)
			end

			if PHMissionsComplete >= 7 then
				TActivate("MyFinalMessageGoodbye")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CDPH03_Armada" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local items = {
							"hp_upgrade",
							"AA152mmATGMCD01",
							"AA152mmATGMCD01"
						  }

			if IsQuestComplete("CD_PH03_DestroyBattleship") then
				AddRewardItems(items)

				if IsQuestFailed("CD_PH03_ProtectCruiser") then
					AddBook("book_cdph03_success")
				else
					AddBook("book_cdph03_victory")
				end
			else
				AddBook("book_cdph03_failure")
			end

			-- the thank you message
			local PHMissionsComplete = GetVar("PHMissionsComplete").AsInt
			if PHMissionsComplete ~= -1 then
				PHMissionsComplete = PHMissionsComplete + 1
				println("some missions were completed before, setting to "..PHMissionsComplete)
				LOG("some missions were completed before, setting to "..PHMissionsComplete)
				SetVar("PHMissionsComplete", PHMissionsComplete)
			else
				println("no missions were completed before, setting to 1")
				LOG("no missions were completed before, setting to 1")
				SetVar("PHMissionsComplete", 1)
			end

			if PHMissionsComplete >= 7 then
				TActivate("MyFinalMessageGoodbye")
			end

			trigger:Deactivate()
		</script>
	</trigger>
</triggers>