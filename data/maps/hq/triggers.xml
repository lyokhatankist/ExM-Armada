<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
	<trigger Name="GlobalVar" active="1">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("OnMission", 0)

			SetVar("CDTotalPoints", 0)
			SetVar("CDTotalManpowerLosses", 0)
			SetVar("CDTotalEquipmentLosses", 0)
			SetVar("CDTotalManpowerDestroyed", 0)
			SetVar("CDTotalEquipmentDestroyed", 0)

			SetVar("CITTotalPoints", 0)
			SetVar("CITTotalManpowerLosses", 0)
			SetVar("CITTotalEquipmentLosses", 0)
			SetVar("CITTotalManpowerDestroyed", 0)
			SetVar("CITTotalEquipmentDestroyed", 0)

			g_ObjCont:SetGameTime( 7, 0, 29, 3, 2265 )

			SetRadarUpgrade(1)

			Radar:SetScanRadius(1000)

			ShowMap()

			Journal:AddClanToEncyclopaedia(1000)
			Journal:AddClanToEncyclopaedia(1050)

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				AddPlayerVehicle("HQVehicle01")
				local vehPlayerNew = GetPlayerVehicle()
				if vehPlayerNew then
					vehPlayerNew:SetGamePositionOnGround(CVector(1024, 275, 1024))
					vehPlayerNew:SetCustomLinearVelocity(0)
					vehPlayerNew:SetThrottle(0)
				end
			end

			println("jopka")

			local b
			if (IsQuestComplete("CD_Tutorial") or IsQuestFailed("CD_Tutorial")) then
				TActivate("ShowMissionStats_Tutorial")
			end

			println("jopka")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ShowMissionStats_Tutorial" active="0">
		<event timeout="0.05" eventid="GE_TIME_PERIOD" />
		<script>
			local b = SpawnMessageBox( "101" )
			if b == 1 then
				b = SpawnMessageBox( "102" )
				if b == 1 then
					b = SpawnMessageBox( "103" )
					if b == 1 then
						b = SpawnMessageBox( "104" )
						if b == 1 then
							ShowMissionStats()
						end
					end
				end
			end

			Radar:SetScanRadius(1000)
			
			trigger:Deactivate()
		</script>
	</trigger>

<!-- "7 Махов". Установка текущей погоды при выезде из городов для устранения случайных сбоев гаммы окружающего пространства.-->
	<trigger	Name="trExitFromTowns" 	active="1">
		<event	eventid="GE_LEAVE_TOWN"	ObjName="Headquarters"	/>
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				local playerPos = vehPlayer:GetPosition()
				vehPlayer:SetGamePositionOnGround(playerPos)
				vehPlayer:SetCustomLinearVelocity(0)
				vehPlayer:SetThrottle(0)
			end

			UpdateWeather()
		</script>
	</trigger>
<!-- "7 Махов". -->

	<trigger Name="ShowMissionStats" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local OnMission = GetVar("OnMission").AsInt
			if OnMission ~= 1 then
				local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
					local playerPos = vehPlayer:GetPosition()
					AddPlayerVehicle("HQVehicle01")
					vehPlayer = GetPlayerVehicle()
					vehPlayer:SetGamePositionOnGround(playerPos)
					vehPlayer:SetCustomLinearVelocity(0)
					vehPlayer:SetThrottle(0)
				end

				TActivate("ShowMissionStats_II")
			end

		</script>
	</trigger>

	<trigger Name="ShowMissionStats_II" active="0">
		<event timeout="0.05" eventid="GE_TIME_PERIOD" />
		<script>
			ShowMissionStats()

			Radar:SetScanRadius(1000)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="HQMove" active="1">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>
			local HQ = getObj("Headquarters")
			if HQ then
				HQ:SetPosition(CVector(1024, 275, 1024))
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CITPH01_Counterattack" active="0">
		<event	eventid="GE_LEAVE_TOWN"	ObjName="Headquarters" />
		<script>
			local missionLoc = GetVar("MissionLoc").AsString
			local b = SpawnMessageBox( "1000" )
			if b == 1 then
				local missionParams = StringToTable(GetVar("MissionParams").AsString)
				gMissionTime = StringToTable(missionParams[1])
				SetVar("OnMission", 0)
				TActivate("ShowMissionStats")

				trigger:Deactivate()
				
				PassToMap(missionLoc, "MissionStartLoc", 90, true )
			end

		</script>
	</trigger>
</triggers>